"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[1636],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(96540);const t={},r=s.createContext(t);function l(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(r.Provider,{value:n},e.children)}},29958:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"server/publication_filtering","title":"Channel publication filtering","description":"Publication filtering allows clients to subscribe to a channel with a filter, ensuring that only publications with tags matching the specified criteria are delivered to the subscriber. This feature can significantly reduce bandwidth usage and minimize client-side processing overhead by filtering out irrelevant messages at the server level.","source":"@site/docs/server/publication_filtering.md","sourceDirName":"server","slug":"/server/publication_filtering","permalink":"/docs/server/publication_filtering","draft":false,"unlisted":false,"editUrl":"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/publication_filtering.md","tags":[],"version":"current","frontMatter":{"id":"publication_filtering","sidebar_label":"Publication filtering","title":"Channel publication filtering"},"sidebar":"Guides","previous":{"title":"Delta compression","permalink":"/docs/server/delta_compression"},"next":{"title":"Online presence","permalink":"/docs/server/presence"}}');var t=i(74848),r=i(28453);const l={id:"publication_filtering",sidebar_label:"Publication filtering",title:"Channel publication filtering"},c=void 0,a={},o=[{value:"Implementation notes",id:"implementation-notes",level:2},{value:"Enable publication filtering",id:"enable-publication-filtering",level:2},{value:"How it works",id:"how-it-works",level:2},{value:"FilterNode structure",id:"filternode-structure",level:3},{value:"Comparison operators",id:"comparison-operators",level:3},{value:"Logical operators",id:"logical-operators",level:3},{value:"Validation and error handling",id:"validation-and-error-handling",level:3},{value:"Publishing with tags",id:"publishing-with-tags",level:2},{value:"Usage in real-time SDK",id:"usage-in-real-time-sdk",level:2},{value:"Basic tags filter",id:"basic-tags-filter",level:3},{value:"More complex tags filter",id:"more-complex-tags-filter",level:3},{value:"Filter construction helper",id:"filter-construction-helper",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["Publication filtering allows clients to subscribe to a channel with a filter, ensuring that only publications with tags matching the specified criteria are delivered to the subscriber. This feature ",(0,t.jsx)(n.strong,{children:"can significantly reduce bandwidth usage"})," and minimize client-side processing overhead by filtering out irrelevant messages at the server level."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"publication filtering",src:i(59056).A+"",width:"3980",height:"921"})}),"\n",(0,t.jsx)(n.admonition,{title:"Optimization feature",type:"info",children:(0,t.jsxs)(n.p,{children:["Publication filtering is designed purely for ",(0,t.jsx)(n.strong,{children:"bandwidth and performance optimization"}),". It is not a security feature and should not be used for access control or data protection. Channel-level security and permissions should be managed through Centrifugo's authentication and authorization mechanisms. Channel subscribers can read all the data in a channel!"]})}),"\n",(0,t.jsx)(n.p,{children:"When combined with channels that publish messages with data tags, publication filtering enables fine-grained content delivery based on subscriber interests and requirements."}),"\n",(0,t.jsx)(n.h2,{id:"implementation-notes",children:"Implementation notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Publication filtering works only with client-side subscriptions at this point."}),"\n",(0,t.jsxs)(n.li,{children:["Publication filtering is only supported by ",(0,t.jsx)(n.code,{children:"centrifuge-js"})," for now, ",(0,t.jsx)(n.a,{href:"#usage-in-real-time-sdk",children:"see below the examples"})]}),"\n",(0,t.jsxs)(n.li,{children:["Publication filtering cannot be used together with ",(0,t.jsx)(n.a,{href:"/docs/server/delta_compression",children:"delta compression"})," in the same channel \u2013 both features serve as alternative approaches for bandwidth optimization and are mutually exclusive in Centrifugo."]}),"\n",(0,t.jsxs)(n.li,{children:["It is recommended to avoid the design where a single subscriber to channel can not keep up with all the messages in the channel if filter is not used. Filter should be used as a bandwidth optimization, mostly in scenarios where client already skips some messages received from the channel. Or at least make sure that you don't have scenarios in the app where a subscriber is overwhelmed with messages from the channel \u2013 this results into bad UX and disconnections with ",(0,t.jsx)(n.code,{children:"slow"}),' reason. Remember \u2013 Centrifugo is a client-facing PUB/SUB system, where each channel publication is processed by each subscriber. It\'s a pattern completely different from "Queue" where large volume of messages in topic may be shared over many consumers thus each consumer only processes a fraction of messages achieving high throughput in terms of a single topic.']}),"\n",(0,t.jsxs)(n.li,{children:["Publication filtering works seamlessly with Centrifugo's automatic recovery mechanisms: in case of successful recovery, only publications matching the filter are returned during ",(0,t.jsx)(n.a,{href:"/docs/server/history_and_recovery#automatic-message-recovery",children:"stream recovery"}),", and only the latest matching publication is returned when using ",(0,t.jsx)(n.a,{href:"/docs/server/cache_recovery",children:"cache recovery mode"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"Centrifugo tag filters designed to be zero-allocation during publication broadcast towards many subscribers, the CPU overhead of using filter must be negligible for most setups. Having filters adds memory overhead for each subscription since Centrifugo need to keep them during the entire lifetime of the connection."}),"\n",(0,t.jsxs)(n.li,{children:["See more details about the decisions made in the ",(0,t.jsx)(n.a,{href:"/blog/2025/10/14/server-side-publication-filtering-by-tags",children:"Publication filtering by tags - reducing bandwidth with server-side stream filtering"})," blog post."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"enable-publication-filtering",children:"Enable publication filtering"}),"\n",(0,t.jsxs)(n.p,{children:["To allow clients the usage of publication tags-based filtering in a channel, you need to enable the feature in your Centrifugo configuration by setting the ",(0,t.jsx)(n.code,{children:"allow_tags_filter"})," option to ",(0,t.jsx)(n.code,{children:"true"})," for the desired namespace."]}),"\n",(0,t.jsx)(n.p,{children:"Example configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "channel": {\n    "namespaces": [\n      {\n        "name": "market",\n        "allow_tags_filter": true\n      }\n    ]\n  }\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How it works"}),"\n",(0,t.jsxs)(n.p,{children:["Publication filtering is based on ",(0,t.jsx)(n.strong,{children:"tags"})," \u2013 a ",(0,t.jsx)(n.code,{children:"map[string]string"})," attached to each publication. When publishing a message, you can include tags as metadata, and subscribers can specify filters to receive only publications with tags that match their criteria."]}),"\n",(0,t.jsx)(n.p,{children:"The filtering system uses a tree-based filter structure that supports:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Comparison operations"}),": equality, inequality, existence checks, string operations, numeric comparisons"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Logical operations"}),": AND, OR, NOT combinations"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set operations"}),": membership checks"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Filters are defined using a tree structure where each node can be either a comparison operation (leaf node) or a logical operation (branch node). The filter is passed to the subscription request and evaluated server-side for each publication."}),"\n",(0,t.jsx)(n.h3,{id:"filternode-structure",children:"FilterNode structure"}),"\n",(0,t.jsxs)(n.p,{children:["Tags filter may be represented in the client protocol using ",(0,t.jsx)(n.code,{children:"FilterNode"})," object. It may be set in client-side subscribe request. Here is its structure:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field name"}),(0,t.jsx)(n.th,{children:"Field type"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"op"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsxs)(n.td,{children:["Operation type: skip for leaf node (comparison), ",(0,t.jsx)(n.code,{children:'"and"'})," for logical AND, ",(0,t.jsx)(n.code,{children:'"or"'})," for logical OR, ",(0,t.jsx)(n.code,{children:'"not"'})," for logical NOT"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"key"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Key for comparison (required for leaf nodes, not used for logical operations)"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"cmp"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsxs)(n.td,{children:["Comparison operator for leaf nodes (required when ",(0,t.jsx)(n.code,{children:"op"})," is empty). See comparison operators table below"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"val"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsxs)(n.td,{children:["Single value used in most comparisons (e.g. ",(0,t.jsx)(n.code,{children:"eq"}),", ",(0,t.jsx)(n.code,{children:"neq"}),", ",(0,t.jsx)(n.code,{children:"gt"}),", etc.)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"vals"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array[string]"})}),(0,t.jsxs)(n.td,{children:["Multiple values used for set comparisons (",(0,t.jsx)(n.code,{children:"in"}),", ",(0,t.jsx)(n.code,{children:"nin"}),")"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"nodes"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"array[FilterNode]"})}),(0,t.jsxs)(n.td,{children:["Child nodes, only for logical operations (",(0,t.jsx)(n.code,{children:"and"}),", ",(0,t.jsx)(n.code,{children:"or"}),", ",(0,t.jsx)(n.code,{children:"not"}),")"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"While it may seem complex, below you will see many examples which should make things crystal clear."}),"\n",(0,t.jsx)(n.h3,{id:"comparison-operators",children:"Comparison operators"}),"\n",(0,t.jsx)(n.p,{children:"Here's how different filter operators work:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Operator"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Notes"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"eq"})}),(0,t.jsx)(n.td,{children:"Equal to value"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"neq"})}),(0,t.jsx)(n.td,{children:"Not equal to value"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"in"})}),(0,t.jsx)(n.td,{children:"Value is in list"}),(0,t.jsxs)(n.td,{children:["Uses ",(0,t.jsx)(n.code,{children:"vals"})," array field"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"nin"})}),(0,t.jsx)(n.td,{children:"Value is not in list"}),(0,t.jsxs)(n.td,{children:["Uses ",(0,t.jsx)(n.code,{children:"vals"})," array field"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ex"})}),(0,t.jsx)(n.td,{children:"Key exists"}),(0,t.jsxs)(n.td,{children:["No ",(0,t.jsx)(n.code,{children:"val"})," or ",(0,t.jsx)(n.code,{children:"vals"})," field needed"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"nex"})}),(0,t.jsx)(n.td,{children:"Key does not exist"}),(0,t.jsxs)(n.td,{children:["No ",(0,t.jsx)(n.code,{children:"val"})," or ",(0,t.jsx)(n.code,{children:"vals"})," field needed"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sw"})}),(0,t.jsx)(n.td,{children:"String starts with"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ew"})}),(0,t.jsx)(n.td,{children:"String ends with"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ct"})}),(0,t.jsx)(n.td,{children:"String contains"}),(0,t.jsx)(n.td,{})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"gt"})}),(0,t.jsx)(n.td,{children:"Numerically greater than"}),(0,t.jsx)(n.td,{children:"Tag value must be numeric, otherwise value is skipped"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"gte"})}),(0,t.jsx)(n.td,{children:"Numerically greater than or equal"}),(0,t.jsx)(n.td,{children:"Tag value must be numeric, otherwise value is skipped"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"lt"})}),(0,t.jsx)(n.td,{children:"Numerically less than"}),(0,t.jsx)(n.td,{children:"Tag value must be numeric, otherwise value is skipped"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"lte"})}),(0,t.jsx)(n.td,{children:"Numerically less than or equal"}),(0,t.jsx)(n.td,{children:"Tag value must be numeric, otherwise value is skipped"})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Let's say we have a publication with these tags:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "ticker": "AAPL",\n  "source": "NASDAQ",\n  "price": "150.25",\n  "category": "tech",\n  "volume": "1000"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Filter structure examples (all match the example tags above):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'// Equal: ticker = "AAPL" \u2192 \u2705 Matches (ticker is "AAPL")\n{"key": "ticker", "cmp": "eq", "val": "AAPL"}\n\n// Not equal: source != "TEST" \u2192 \u2705 Matches (source is "NASDAQ", not "TEST")\n{"key": "source", "cmp": "neq", "val": "TEST"}\n\n// In list: category in ["tech", "finance"] \u2192 \u2705 Matches (category is "tech")\n{"key": "category", "cmp": "in", "vals": ["tech", "finance"]}\n\n// Not in list: ticker not in ["MSFT", "GOOGL"] \u2192 \u2705 Matches (ticker "AAPL" not in list)\n{"key": "ticker", "cmp": "nin", "vals": ["MSFT", "GOOGL"]}\n\n// Key exists: price exists \u2192 \u2705 Matches (price field exists)\n{"key": "price", "cmp": "ex"}\n\n// Key does not exist: internal_id does not exist \u2192 \u2705 Matches (no internal_id field)\n{"key": "internal_id", "cmp": "nex"}\n\n// String starts with: ticker starts with "AA" \u2192 \u2705 Matches ("AAPL" starts with "AA")\n{"key": "ticker", "cmp": "sw", "val": "AA"}\n\n// String ends with: source ends with "DAQ" \u2192 \u2705 Matches ("NASDAQ" ends with "DAQ")\n{"key": "source", "cmp": "ew", "val": "DAQ"}\n\n// String contains: category contains "ec" \u2192 \u2705 Matches ("tech" contains "ec")\n{"key": "category", "cmp": "ct", "val": "ec"}\n\n// Greater than: price > 100 \u2192 \u2705 Matches (150.25 > 100)\n{"key": "price", "cmp": "gt", "val": "100"}\n\n// Greater than or equal: volume >= 1000 \u2192 \u2705 Matches (1000 >= 1000)\n{"key": "volume", "cmp": "gte", "val": "1000"}\n\n// Less than: price < 200 \u2192 \u2705 Matches (150.25 < 200)\n{"key": "price", "cmp": "lt", "val": "200"}\n\n// Less than or equal: volume <= 1000 \u2192 \u2705 Matches (1000 <= 1000)\n{"key": "volume", "cmp": "lte", "val": "1000"}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"logical-operators",children:"Logical operators"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Operator"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"and"})}),(0,t.jsxs)(n.td,{children:["All child conditions (in ",(0,t.jsx)(n.code,{children:"nodes"}),") must be true"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"or"})}),(0,t.jsxs)(n.td,{children:["At least one child condition (in ",(0,t.jsx)(n.code,{children:"nodes"}),") must be true"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"not"})}),(0,t.jsxs)(n.td,{children:["Inverts the result of a single child condition (only one ",(0,t.jsx)(n.code,{children:"node"})," in ",(0,t.jsx)(n.code,{children:"nodes"})," expected)"]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Let's say we have a publication with these tags:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "ticker": "AAPL",\n  "source": "NASDAQ",\n  "price": "150.25",\n  "category": "tech",\n  "volume": "1000"\n}\n'})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Logical filter structure examples (all match the example tags above):"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'// ticker = "AAPL" AND category = "tech" \u2192 \u2705 Matches (both conditions true)\n{\n  "op": "and",\n  "nodes": [\n    {"key": "ticker", "cmp": "eq", "val": "AAPL"},\n    {"key": "category", "cmp": "eq", "val": "tech"}\n  ]\n}\n\n// ticker = "MSFT" OR category = "tech" \u2192 \u2705 Matches (category = "tech" is true)\n{\n  "op": "or",\n  "nodes": [\n    {"key": "ticker", "cmp": "eq", "val": "MSFT"},\n    {"key": "category", "cmp": "eq", "val": "tech"}\n  ]\n}\n\n// NOT (source = "NYSE") \u2192 \u2705 Matches (source is "NASDAQ", not "NYSE")\n{\n  "op": "not",\n  "nodes": [\n    {"key": "source", "cmp": "eq", "val": "NYSE"}\n  ]\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"validation-and-error-handling",children:"Validation and error handling"}),"\n",(0,t.jsxs)(n.p,{children:["Filters are validated when a subscription is established. Invalid filters result in subscription rejection with ",(0,t.jsx)(n.code,{children:"ErrorBadRequest"}),". Common validation issues include:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Missing comparison operator for leaf nodes"}),"\n",(0,t.jsx)(n.li,{children:"Missing key for comparison operations (except existence checks)"}),"\n",(0,t.jsxs)(n.li,{children:["Empty value lists for ",(0,t.jsx)(n.code,{children:"in"}),"/",(0,t.jsx)(n.code,{children:"nin"})," operations"]}),"\n",(0,t.jsx)(n.li,{children:"Invalid operator or comparison values"}),"\n",(0,t.jsx)(n.li,{children:"Incorrect child node counts for logical operations"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["During runtime evaluation, invalid numeric values for numeric comparisons cause the filter to evaluate to ",(0,t.jsx)(n.code,{children:"false"}),", ensuring graceful degradation."]}),"\n",(0,t.jsx)(n.h2,{id:"publishing-with-tags",children:"Publishing with tags"}),"\n",(0,t.jsxs)(n.p,{children:["When publishing messages to channels (assuming Centrifugo runs on ",(0,t.jsx)(n.code,{children:"localhost:8000"}),"), include ",(0,t.jsx)(n.code,{children:"tags"})," as part of ",(0,t.jsx)(n.a,{href:"/docs/server/server_api#publishrequest",children:"server API publish request"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl --header "X-API-Key: <API_KEY>" \\\n  --request POST \\\n  --data \'{\n    "channel": "market:stocks",\n    "data": {\n      "ticker": "AAPL",\n      "source": "NASDAQ",\n      "price": "150.25",\n      "category": "tech"\n    },\n    "tags": {\n      "ticker": "AAPL",\n      "source": "NASDAQ",\n      "price": "150.25"\n    }\n  }\' \\\n  http://localhost:8000/api/publish\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note, tags are available on the client-side in incoming publication context \u2013 so it's not necessary to duplicate the same keys and values in both ",(0,t.jsx)(n.code,{children:"data"})," and ",(0,t.jsx)(n.code,{children:"tags"}),". The design to choose here is up to the application developers."]}),"\n",(0,t.jsx)(n.h2,{id:"usage-in-real-time-sdk",children:"Usage in real-time SDK"}),"\n",(0,t.jsxs)(n.p,{children:["Now let's see how tags filters may be set in real-time SDK. Don't forget that usage of filters ",(0,t.jsx)(n.a,{href:"#enable-publication-filtering",children:"must be explicitly enabled"})," in server configuration for a namespace."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["At this moment only ",(0,t.jsx)(n.code,{children:"centrifuge-js"})," SDK supports tags filter."]})}),"\n",(0,t.jsx)(n.h3,{id:"basic-tags-filter",children:"Basic tags filter"}),"\n",(0,t.jsx)(n.p,{children:"Subscribe to a channel and receive only publications for a specific ticker:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'const tagsFilter = {\n    key: "ticker",\n    cmp: "eq",\n    val: "AAPL"\n};\n\nconst sub = centrifuge.newSubscription("market:stocks", {\n    tagsFilter: tagsFilter\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"more-complex-tags-filter",children:"More complex tags filter"}),"\n",(0,t.jsxs)(n.p,{children:["Use logical operators to create more sophisticated filters (using ",(0,t.jsx)(n.code,{children:"op"})," field):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// Receive AAPL stocks from NASDAQ only\nconst tagsFilter = {\n    op: "and",\n    nodes: [\n        {\n            key: "ticker",\n            cmp: "eq",\n            val: "AAPL"\n        },\n        {\n            key: "source",\n            cmp: "eq",\n            val: "NASDAQ"\n        }\n    ]\n};\n\nconst sub = centrifuge.newSubscription("market:stocks", {\n    tagsFilter: tagsFilter\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"filter-construction-helper",children:"Filter construction helper"}),"\n",(0,t.jsxs)(n.p,{children:["For better type safety and code maintainability, consider using a filter construction helper (it's not part of ",(0,t.jsx)(n.code,{children:"centrifuge-js"})," at this point):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'const Filter = {\n  // Comparison operators.\n  eq: (key, val) => ({ key, cmp: "eq", val }),\n  neq: (key, val) => ({ key, cmp: "neq", val }),\n  in: (key, vals) => ({ key, cmp: "in", vals }),\n  nin: (key, vals) => ({ key, cmp: "nin", vals }),\n  exists: (key) => ({ key, cmp: "ex" }),\n  notExists: (key) => ({ key, cmp: "nex" }),\n  startsWith: (key, val) => ({ key, cmp: "sw", val }),\n  endsWith: (key, val) => ({ key, cmp: "ew", val }),\n  contains: (key, val) => ({ key, cmp: "ct", val }),\n  gt: (key, val) => ({ key, cmp: "gt", val }),\n  gte: (key, val) => ({ key, cmp: "gte", val }),\n  lt: (key, val) => ({ key, cmp: "lt", val }),\n  lte: (key, val) => ({ key, cmp: "lte", val }),\n  // Logical operators.\n  and: (...nodes) => ({ op: "and", nodes }),\n  or: (...nodes) => ({ op: "or", nodes }),\n  not: (node) => ({ op: "not", nodes: [node] })\n};\n'})}),"\n",(0,t.jsx)(n.p,{children:"Usage example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// ticker = "AAPL"\nconst tagsFilter = Filter.eq("ticker", "AAPL"); \n\nconst sub = centrifuge.newSubscription("market:stocks", {\n    tagsFilter: tagsFilter\n});\n'})}),"\n",(0,t.jsx)(n.p,{children:"Or more complex:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'// (ticker = "AAPL") AND (price >= "100") AND (source in ["NASDAQ", "NYSE"])\nconst tagsFilter = Filter.and(\n  Filter.eq("ticker", "AAPL"),\n  Filter.gte("price", "100"),\n  Filter.in("source", ["NASDAQ", "NYSE"])\n);\n\nconst sub = centrifuge.newSubscription("market:stocks", {\n    tagsFilter: tagsFilter\n});\n'})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},59056:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/publication_filtering-b016376623268f18b8fa70b9815799b9.png"}}]);