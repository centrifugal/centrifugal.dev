"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[3981],{20999:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>l,toc:()=>c});var i=t(85893),s=t(11151);const o={id:"singleflight",title:"Singleflight"},r=void 0,l={id:"pro/singleflight",title:"Singleflight",description:"Centrifugo PRO provides an additional boolean option use_singleflight (default false). When this option enabled Centrifugo will automatically try to merge identical requests to history, online presence or presence stats issued at the same time into one real network request. It will do this by using in-memory component called singleflight.",source:"@site/versioned_docs/version-4/pro/singleflight.md",sourceDirName:"pro",slug:"/pro/singleflight",permalink:"/docs/4/pro/singleflight",draft:!1,unlisted:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/versioned_docs/version-4/pro/singleflight.md",tags:[],version:"4",frontMatter:{id:"singleflight",title:"Singleflight"},sidebar:"Pro",previous:{title:"Faster performance",permalink:"/docs/4/pro/performance"},next:{title:"Message batching control",permalink:"/docs/4/pro/client_message_batching"}},a={},c=[];function d(e){const n={admonition:"admonition",code:"code",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Centrifugo PRO provides an additional boolean option ",(0,i.jsx)(n.code,{children:"use_singleflight"})," (default ",(0,i.jsx)(n.code,{children:"false"}),"). When this option enabled Centrifugo will automatically try to merge identical requests to history, online presence or presence stats issued at the same time into one real network request. It will do this by using in-memory component called ",(0,i.jsx)(n.code,{children:"singleflight"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"Singleflight",src:t(11117).Z+"",width:"4259",height:"858"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsx)(n.p,{children:"While it can seem similar, singleflight is not a cache. It only combines identical parallel requests into one. If requests come one after another \u2013 they will be sent separately to the broker or presence storage."})}),"\n",(0,i.jsx)(n.p,{children:"This option can radically reduce a load on a broker in the following situations:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Many clients subscribed to the same channel and in case of massive reconnect scenario try to access history simultaneously to restore a state (whether manually using history API or over automatic recovery feature)"}),"\n",(0,i.jsx)(n.li,{children:"Many clients subscribed to the same channel and positioning feature is on so Centrifugo tracks client position"}),"\n",(0,i.jsx)(n.li,{children:"Many clients subscribed to the same channel and in case of massive reconnect scenario try to call presence or presence stats simultaneously"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Using this option only makes sense with remote engine (Redis, KeyDB, Tarantool), it won't provide a benefit in case of using a Memory engine."}),"\n",(0,i.jsx)(n.p,{children:"To enable:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n    ...\n    "use_singleflight": true\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Or via ",(0,i.jsx)(n.code,{children:"CENTRIFUGO_USE_SINGLEFLIGHT"})," environment variable."]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},11117:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/singleflight-35650f07c8cda65fec55fd490157a6a0.png"},11151:(e,n,t)=>{t.d(n,{Z:()=>l,a:()=>r});var i=t(67294);const s={},o=i.createContext(s);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);