"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[3948],{28453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var a=i(96540);const s={},t=a.createContext(s);function l(e){const n=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),a.createElement(t.Provider,{value:n},e.children)}},50134:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"pro/client_publications","title":"Ephemeral client publications","description":"Centrifugo PRO provides schema validation for client publications, enabling ephemeral messaging: client publications can pass through Centrifugo directly without involving backend proxy logic, reducing backend load and delivery latency. Normally the backend is required because it may validate and store messages in the main database, but for certain types of messages\u2014such as typing notifications in a chat room\u2014backend involvement adds unnecessary overhead. Centrifugo PRO offers an efficient way to address that.","source":"@site/docs/pro/draft_client_publications.md","sourceDirName":"pro","slug":"/pro/client_publications","permalink":"/docs/pro/client_publications","draft":false,"unlisted":false,"editUrl":"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/pro/draft_client_publications.md","tags":[],"version":"current","frontMatter":{"id":"client_publications","title":"Ephemeral client publications","sidebar_label":"Ephemeral publications"}}');var s=i(74848),t=i(28453);const l={id:"client_publications",title:"Ephemeral client publications",sidebar_label:"Ephemeral publications"},r=void 0,c={},o=[{value:"Overview",id:"overview",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Defining schemas",id:"defining-schemas",level:3},{value:"JSON Schema (default)",id:"json-schema-default",level:4},{value:"Empty Binary Schema",id:"empty-binary-schema",level:4},{value:"Schema from file",id:"schema-from-file",level:4},{value:"Applying schemas to channels",id:"applying-schemas-to-channels",level:3},{value:"Multiple schemas",id:"multiple-schemas",level:3},{value:"Client publication tags",id:"client-publication-tags",level:2},{value:"Configuration",id:"configuration-1",level:3},{value:"Available CEL variables",id:"available-cel-variables",level:3},{value:"Examples",id:"examples",level:3},{value:"Excluding client info",id:"excluding-client-info",level:2},{value:"Complete example",id:"complete-example",level:2},{value:"Example with Empty Binary Schema",id:"example-with-empty-binary-schema",level:3},{value:"Behavior",id:"behavior",level:2},{value:"Schema validation",id:"schema-validation",level:3},{value:"Configuration validation",id:"configuration-validation",level:3},{value:"Bottom line",id:"bottom-line",level:3},{value:"See also",id:"see-also",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Centrifugo PRO provides schema validation for client publications, enabling ephemeral messaging: client publications can pass through Centrifugo directly without involving backend proxy logic, reducing backend load and delivery latency. Normally the backend is required because it may validate and store messages in the main database, but for certain types of messages\u2014such as typing notifications in a chat room\u2014backend involvement adds unnecessary overhead. Centrifugo PRO offers an efficient way to address that."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"The feature consists of three parts which together provide a ground for ephemeral client publications:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Validation layer"})," - validate client publications based on JSON schema"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Bandwidth optimization"})," - optionally exclude client info from publications to reduce message size"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Server-side tagging"})," - attach custom tags to publications that cannot be spoofed by clients"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsx)(n.h3,{id:"defining-schemas",children:"Defining schemas"}),"\n",(0,s.jsx)(n.p,{children:"Schemas are defined at the top level of Centrifugo configuration. Centrifugo supports two types of schemas:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"JSON Schema"})," (",(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"}),") - Validates publication data against JSON Schema Draft 2020-12"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Empty Binary"})," (",(0,s.jsx)(n.code,{children:"empty_binary"}),") - Only allows empty binary data (useful for presence-like signals)"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Security Default",type:"info",children:(0,s.jsxs)(n.p,{children:["For JSON schemas, Centrifugo automatically sets ",(0,s.jsx)(n.code,{children:'"additionalProperties": false'})," on object-type schemas unless explicitly specified otherwise. This prevents clients from injecting unexpected fields into validated data."]})}),"\n",(0,s.jsx)(n.h4,{id:"json-schema-default",children:"JSON Schema (default)"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"type"})," field is optional and defaults to ",(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"}),". You can define schemas directly in your configuration file:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "schemas": [\n    {\n      "name": "chat_message",\n      "type": "jsonschema_draft_2020_12",\n      "definition": "{\\"type\\":\\"object\\",\\"properties\\":{\\"text\\":{\\"type\\":\\"string\\",\\"maxLength\\":500}},\\"required\\":[\\"text\\"]}"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"For better readability in YAML, use multiline strings:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:'schemas:\n  - name: chat_message\n    type: jsonschema_draft_2020_12  # Optional, this is the default\n    definition: |\n      {\n        "type": "object",\n        "properties": {\n          "text": {"type": "string", "maxLength": 500},\n          "mentions": {"type": "array", "items": {"type": "string"}}\n        },\n        "required": ["text"]\n      }\n'})}),"\n",(0,s.jsx)(n.h4,{id:"empty-binary-schema",children:"Empty Binary Schema"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"empty_binary"}),' schema type validates that publication data is empty. This is useful for presence-like signals where the fact of publication itself carries meaning (e.g., "user is typing"):']}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "schemas": [\n    {\n      "name": "typing_indicator",\n      "type": "empty_binary"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:"schemas:\n  - name: typing_indicator\n    type: empty_binary\n"})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["Empty binary schemas don't require a ",(0,s.jsx)(n.code,{children:"definition"})," field since they only validate that data is empty (0 bytes)."]})}),"\n",(0,s.jsx)(n.h4,{id:"schema-from-file",children:"Schema from file"}),"\n",(0,s.jsx)(n.p,{children:"For complex schemas, you can reference external JSON schema files. This provides better readability, IDE support, and easier maintenance:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Create a schema file:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="schemas/chat_message.json"',children:'{\n  "type": "object",\n  "properties": {\n    "text": {\n      "type": "string",\n      "maxLength": 500,\n      "minLength": 1\n    },\n    "mentions": {\n      "type": "array",\n      "items": {"type": "string"}\n    },\n    "metadata": {\n      "type": "object",\n      "properties": {\n        "timestamp": {"type": "integer"}\n      }\n    }\n  },\n  "required": ["text"]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Reference it in your config:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "schemas": [\n    {\n      "name": "chat_message",\n      "definition": "./schemas/chat_message.json"\n    },\n    {\n      "name": "reaction",\n      "definition": "./schemas/reaction.json"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:"Or in YAML:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",metastring:'title="config.yaml"',children:"schemas:\n  - name: chat_message\n    definition: ./schemas/chat_message.json\n  - name: reaction\n    definition: ./schemas/reaction.json\n  - name: typing\n    definition: ./schemas/typing.json\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Benefits of schema files",type:"tip",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Better IDE support"})," - Syntax highlighting, validation, and autocomplete"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Easier testing"})," - Validate schema files independently"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Cleaner diffs"})," - Track schema changes separately in version control"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Reusability"})," - Share schemas across environments or services"]}),"\n"]})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:'"additionalProperties": false'})," is automatically added to object schemas for security. You can explicitly set ",(0,s.jsx)(n.code,{children:'"additionalProperties": true'})," in your schema file if you need to allow extra fields."]})}),"\n",(0,s.jsx)(n.h3,{id:"applying-schemas-to-channels",children:"Applying schemas to channels"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"client_publication_data_schemas"})," in channel or namespace configuration to apply validation:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "schemas": [\n    {\n      "name": "typing",\n      "definition": "{\\"type\\":\\"object\\",\\"properties\\":{},\\"additionalProperties\\": false]}"\n    }\n  ],\n  "channel": {\n    "namespaces": [\n      {\n        "name": "typings",\n        "publication_data_format": "json",\n        "client_publication_data_schemas": ["typing"],\n        "allow_publish_for_subscriber": true\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.admonition,{title:"Schema Type Compatibility",type:"important",children:[(0,s.jsxs)(n.p,{children:["Schemas must be compatible with the channel's ",(0,s.jsx)(n.code,{children:"publication_data_format"})," setting:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"JSON schemas"})," (",(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"}),") require ",(0,s.jsx)(n.code,{children:'publication_data_format: "json"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Empty binary schemas"})," (",(0,s.jsx)(n.code,{children:"empty_binary"}),") require ",(0,s.jsx)(n.code,{children:'publication_data_format: "binary"'})," to be set"]}),"\n"]}),(0,s.jsx)(n.p,{children:"Centrifugo validates this configuration at startup and will reject incompatible combinations."})]}),"\n",(0,s.jsx)(n.h3,{id:"multiple-schemas",children:"Multiple schemas"}),"\n",(0,s.jsxs)(n.p,{children:["When multiple schemas are configured, the publication data must match ",(0,s.jsx)(n.strong,{children:"at least one"})," of them. This allows supporting different message types in the same channel:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "schemas": [\n    {\n      "name": "typing",\n      "definition": "{\\"type\\":\\"object\\",\\"properties\\":{\\"is_typing\\":{\\"type\\":\\"boolean\\"}},\\"required\\":[\\"is_typing\\"]}"\n    },\n    {\n      "name": "reaction",\n      "definition": "{\\"type\\":\\"object\\",\\"properties\\":{\\"emoji\\":{\\"type\\":\\"string\\",\\"enum\\":[\\"\ud83d\udc4d\\",\\"\ud83d\udc4e\\",\\"\u2764\ufe0f\\",\\"\ud83d\ude02\\",\\"\ud83d\ude2e\\",\\"\ud83d\ude22\\",\\"\ud83d\ude21\\"]}},\\"required\\":[\\"emoji\\"],\\"additionalProperties\\":false}"\n    }\n  ],\n  "channel": {\n    "namespaces": [\n      {\n        "name": "ephemeral",\n        "publication_data_format": "json",\n        "client_publication_data_schemas": ["typing", "reaction"],\n        "allow_publish_for_subscriber": true\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{type:"note",children:(0,s.jsxs)(n.p,{children:["All schemas referenced in ",(0,s.jsx)(n.code,{children:"client_publication_data_schemas"})," must have the same type (either all ",(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"})," or all ",(0,s.jsx)(n.code,{children:"empty_binary"}),") since they share the same ",(0,s.jsx)(n.code,{children:"publication_data_format"})," setting."]})}),"\n",(0,s.jsx)(n.h2,{id:"client-publication-tags",children:"Client publication tags"}),"\n",(0,s.jsx)(n.p,{children:"Client publication tags allow you to attach server-side metadata to publications that clients cannot forge. This is useful for analytics, routing, or adding contextual information."}),"\n",(0,s.jsx)(n.h3,{id:"configuration-1",children:"Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Tags are defined as key-value pairs. Tag values can be:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Literal strings"})," - Used as-is without any processing"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CEL expressions"})," - Wrapped in ",(0,s.jsx)(n.code,{children:"${...}"})," for dynamic values and conditional logic"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["CEL expressions are ",(0,s.jsx)(n.strong,{children:"pre-compiled and validated at startup"}),", ensuring type safety and optimal runtime performance."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "channel": {\n    "without_namespace": {\n      "client_publication_tags": [\n        {"key": "user_id", "value": "${user}"},\n        {"key": "client_id", "value": "${client}"},\n        {"key": "environment", "value": "production"}\n      ]\n    }\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"available-cel-variables",children:"Available CEL variables"}),"\n",(0,s.jsx)(n.p,{children:"CEL expressions in client publication tags have access to the following variables:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"user"})," (string) - User ID from connection credentials"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"client"})," (string) - Client ID (unique connection identifier)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"timestamp_ms"})," (int) - Current server timestamp in milliseconds (Unix epoch)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"meta"})," (map) - Connection metadata (access nested fields like ",(0,s.jsx)(n.code,{children:"meta.tenant_id"})," or ",(0,s.jsx)(n.code,{children:"meta.user.role"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"vars"})," (map) - Channel pattern variables (requires ",(0,s.jsx)(n.a,{href:"/docs/pro/channel_patterns",children:"channel patterns"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"schema_name"})," (string) - Name of the schema that matched the publication data (empty string if no schemas configured)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["All CEL expressions must return a ",(0,s.jsx)(n.strong,{children:"string type"})," and are validated at configuration load time."]}),"\n",(0,s.jsx)(n.h3,{id:"examples",children:"Examples"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Literal strings and simple variables:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "client_publication_tags": [\n    {"key": "user_id", "value": "${user}"},\n    {"key": "environment", "value": "production"}\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Conditional logic with ternary operator:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "client_publication_tags": [\n    {"key": "tier", "value": "${meta.premium ? \'premium\' : \'free\'}"},\n    {"key": "msg_type", "value": "${vars.room_id == \'chat\' ? \'reaction\' : \'typing\'}"}\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"String concatenation:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "client_publication_tags": [\n    {"key": "label", "value": "${user + \':\' + meta.role}"}\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Complex boolean logic:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "client_publication_tags": [\n    {"key": "access", "value": "${meta.role == \'admin\' || meta.role == \'moderator\' ? \'full\' : \'limited\'}"}\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Using matched schema name:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "client_publication_tags": [\n    {"key": "msg_type", "value": "${schema_name}"},\n    {"key": "priority", "value": "${schema_name == \'urgent_message\' ? \'high\' : \'normal\'}"}\n  ]\n}\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Multi-tenant with channel patterns:"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "channel": {\n    "patterns": true,\n    "namespaces": [\n      {\n        "name": "tenant_chat",\n        "pattern": "/tenants/:tenant_id/chat",\n        "client_publication_tags": [\n          {"key": "tenant", "value": "${vars.tenant_id}"},\n          {"key": "user", "value": "${user}"},\n          {"key": "region", "value": "${meta.region}"}\n        ],\n        "allow_publish_for_subscriber": true\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(n.admonition,{title:"Performance",type:"info",children:(0,s.jsx)(n.p,{children:"CEL expressions are pre-compiled at startup and validated to return string types. At runtime, only the evaluation happens, making the performance impact minimal. Connection metadata is only accessed when CEL expressions reference it."})}),"\n",(0,s.jsx)(n.h2,{id:"excluding-client-info",children:"Excluding client info"}),"\n",(0,s.jsx)(n.p,{children:"By default, Centrifugo includes client information in publications. For bandwidth optimization or privacy reasons, you can exclude this information:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "channel": {\n    "without_namespace": {\n      "client_publication_exclude_client_info": true,\n      "allow_publish_for_subscriber": true\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["This prevents the ",(0,s.jsx)(n.code,{children:"info"})," field from being included in publications."]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"Use this option when:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"You want to reduce bandwidth usage"}),"\n",(0,s.jsx)(n.li,{children:"Client identity is not needed by subscribers"}),"\n",(0,s.jsx)(n.li,{children:"You're using client publication tags to provide necessary metadata"}),"\n"]})]}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete example"}),"\n",(0,s.jsx)(n.p,{children:"Here's a comprehensive example combining all features:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "schemas": [\n    {\n      "name": "reaction",\n      "type": "jsonschema_draft_2020_12",\n      "definition": "{\\"type\\":\\"object\\",\\"properties\\":{\\"emoji\\":{\\"type\\":\\"string\\"},\\"message_id\\":{\\"type\\":\\"string\\"}},\\"required\\":[\\"emoji\\",\\"message_id\\"],\\"additionalProperties\\":false}"\n    }\n  ],\n  "channel": {\n    "patterns": true,\n    "namespaces": [\n      {\n        "name": "room_chat_reactions",\n        "pattern": "/rooms/:room_id/reactions",\n        "publication_data_format": "json",\n        "client_publication_data_schemas": ["reaction"],\n        "client_publication_tags": [\n          {"key": "user_id", "value": "${user}"},\n          {"key": "room_id", "value": "${vars.room_id}"}\n        ],\n        "client_publication_exclude_client_info": true,\n        "allow_publish_for_subscriber": true\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-with-empty-binary-schema",children:"Example with Empty Binary Schema"}),"\n",(0,s.jsxs)(n.p,{children:["Here's an example using ",(0,s.jsx)(n.code,{children:"empty_binary"})," schema for a typing indicator:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "schemas": [\n    {\n      "name": "typing",\n      "type": "empty_binary"\n    }\n  ],\n  "channel": {\n    "patterns": true,\n    "namespaces": [\n      {\n        "name": "room_typing",\n        "pattern": "/rooms/:room_id/typing",\n        "publication_data_format": "binary",\n        "client_publication_data_schemas": ["typing"],\n        "client_publication_tags": [\n          {"key": "user_id", "value": "${user}"},\n          {"key": "room_id", "value": "${vars.room_id}"}\n        ],\n        "client_publication_exclude_client_info": true,\n        "allow_publish_for_subscriber": true\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"behavior",children:"Behavior"}),"\n",(0,s.jsx)(n.h3,{id:"schema-validation",children:"Schema validation"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Publications are validated ",(0,s.jsx)(n.strong,{children:"before"})," being broadcast to subscribers"]}),"\n",(0,s.jsx)(n.li,{children:"If validation fails, the client receives an error and the publication is rejected"}),"\n",(0,s.jsx)(n.li,{children:"Multiple schemas act as an OR condition - data must match at least one schema"}),"\n",(0,s.jsxs)(n.li,{children:["Schema names must reference schemas defined in the top-level ",(0,s.jsx)(n.code,{children:"schemas"})," array"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"configuration-validation",children:"Configuration validation"}),"\n",(0,s.jsx)(n.p,{children:"Centrifugo validates schema configurations at startup:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Schema ",(0,s.jsx)(n.code,{children:"type"})," defaults to ",(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"})," if not specified"]}),"\n",(0,s.jsxs)(n.li,{children:["JSON schemas (",(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"}),") must have a ",(0,s.jsx)(n.code,{children:"definition"})," field"]}),"\n",(0,s.jsxs)(n.li,{children:["Empty binary schemas (",(0,s.jsx)(n.code,{children:"empty_binary"}),") must not have a ",(0,s.jsx)(n.code,{children:"definition"})," field"]}),"\n",(0,s.jsxs)(n.li,{children:["Schema type must be compatible with channel's ",(0,s.jsx)(n.code,{children:"publication_data_format"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"jsonschema_draft_2020_12"})," requires ",(0,s.jsx)(n.code,{children:'publication_data_format: "json"'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"empty_binary"})," requires ",(0,s.jsx)(n.code,{children:'publication_data_format: "binary"'})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["All schemas referenced in ",(0,s.jsx)(n.code,{children:"client_publication_data_schemas"})," must exist"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"bottom-line",children:"Bottom line"}),"\n",(0,s.jsx)(n.p,{children:"Generally speaking all the existing namespace options like recovery/positioning, delta compression, channel batching controls will apply to namespaces with ephemeral client publications also. Then it depends on the specific use case whether you would like to apply those or not."}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/pro/channel_patterns",children:"Channel patterns"})," - use pattern variables in publication tags"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/docs/pro/rate_limiting",children:"Operation rate limiting"})," - rate limit ephemeral publications from client"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);