"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[2442],{3826:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var r=n(7462),i=(n(7294),n(3905));const o={id:"migration_v5",title:"Migrating to v5"},a=void 0,l={unversionedId:"getting-started/migration_v5",id:"getting-started/migration_v5",title:"Migrating to v5",description:"Centrifugo v5 migration from v4 should be smooth for most of the use cases.",source:"@site/docs/getting-started/migration-v5.md",sourceDirName:"getting-started",slug:"/getting-started/migration_v5",permalink:"/docs/getting-started/migration_v5",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/getting-started/migration-v5.md",tags:[],version:"current",frontMatter:{id:"migration_v5",title:"Migrating to v5"},sidebar:"Introduction",previous:{title:"Ecosystem notes",permalink:"/docs/getting-started/ecosystem"}},s={},u=[{value:"Client SDK token behaviour adjustments",id:"client-sdk-token-behaviour-adjustments",level:2},{value:"Node communication format changed",id:"node-communication-format-changed",level:2},{value:"Old HTTP API format is DEPRECATED",id:"old-http-api-format-is-deprecated",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"Shutting down Centrifugo v2 doc site",id:"shutting-down-centrifugo-v2-doc-site",level:2}],c={toc:u};function d(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Centrifugo v5 migration from v4 should be smooth for most of the use cases."),(0,i.kt)("h2",{id:"client-sdk-token-behaviour-adjustments"},"Client SDK token behaviour adjustments"),(0,i.kt)("p",null,"In Centrifugo v5 ",(0,i.kt)("a",{parentName:"p",href:"/docs/transports/client_api"},"client SDK spec")," was adjusted in regards how SDKs work with tokens."),(0,i.kt)("p",null,"Returning an empty string from ",(0,i.kt)("inlineCode",{parentName:"p"},"getToken")," function (for Javascript, and the same for analogous functions in other SDKs) is a valid scenario which won't result into disconnect on the client side. It's still possible to disconnect client by returning a special error from ",(0,i.kt)("inlineCode",{parentName:"p"},"getToken")," function. We updated all our SDKs to inherit this behaviour. Specifically, here is a list of SDK versions which work according to adjusted spec:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"centrifuge-js >= v4.0.0"),(0,i.kt)("li",{parentName:"ul"},"centrifuge-go >= v0.10.0"),(0,i.kt)("li",{parentName:"ul"},"centrifuge-dart >= v0.10.0"),(0,i.kt)("li",{parentName:"ul"},"centrifuge-swift >= v0.6.0"),(0,i.kt)("li",{parentName:"ul"},"centrifuge-java >= v0.3.0")),(0,i.kt)("p",null,"Nothing prevents you from updating Centrifugo v4 to v5 first and then migrate to new client versions or doing vice versa. ",(0,i.kt)("strong",{parentName:"p"},"This change is client-side only"),". But we bind it to major server release to make it more notable \u2013 as it changes the core SDK behavior."),(0,i.kt)("h2",{id:"node-communication-format-changed"},"Node communication format changed"),(0,i.kt)("p",null,"Avoid running Centrifugo v5 in the same cluster with Centrifugo v4 nodes \u2013 v4 and v5 have backwards incompatible node communication protocols."),(0,i.kt)("h2",{id:"old-http-api-format-is-deprecated"},"Old HTTP API format is DEPRECATED"),(0,i.kt)("p",null,"Prefer using new HTTP API format instead of old one where possible. The old format still works and enabled by default. But we are planning to migrate our API libraries to the new format eventually \u2013 and then remove the old format. If you are using one of our HTTP API libs - at some point a new version will be released which will seamlessly migrate you to the modern HTTP API format."),(0,i.kt)("p",null,"If you are using hand-written requests \u2013 then some refactoring is required. It should be rather straighforward:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"replace request path from ",(0,i.kt)("inlineCode",{parentName:"li"},"/api")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"/api/<method>")),(0,i.kt)("li",{parentName:"ul"},"replace payload from having ",(0,i.kt)("inlineCode",{parentName:"li"},"method")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"params")," on top level. Payload does not include method and params keys anymore. Please refer to: ",(0,i.kt)("a",{parentName:"li",href:"https://centrifugal.dev/blog/2023/06/29/centrifugo-v5-released#new-http-api-format"},"https://centrifugal.dev/blog/2023/06/29/centrifugo-v5-released#new-http-api-format")),(0,i.kt)("li",{parentName:"ul"},"prefer using ",(0,i.kt)("inlineCode",{parentName:"li"},"X-API-Key: <YOUR_API_KEY")," header format instead of ",(0,i.kt)("inlineCode",{parentName:"li"},"Authorization: apikey <YOUR_API_KEY"),".")),(0,i.kt)("p",null,"Don't forget that you can now generate HTTP clients from OpenAPI spec we now maintain for the new HTTP API format."),(0,i.kt)("h2",{id:"other-changes"},"Other changes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"skip_user_check_in_subscription_token")," removed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"reconnect")," flag removed from disconnect API call and proxy structures for custom disconnection"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"use_client_protocol_v1_by_default")," option removed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"disable_client_protocol_v1")," option removed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"redis_tls_skip_verify")," option removed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"presence_ttl")," renamed to ",(0,i.kt)("inlineCode",{parentName:"li"},"global_presence_ttl")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"sockjs_heartbeat_delay")," option removed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"uni_websocket_ping_interval")," option removed"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"websocket_ping_interval")," option removed")),(0,i.kt)("h2",{id:"shutting-down-centrifugo-v2-doc-site"},"Shutting down Centrifugo v2 doc site"),(0,i.kt)("p",null,"With Centrifugo v5 release we are shutting down Centrifugo v2 documentation site - this means ",(0,i.kt)("inlineCode",{parentName:"p"},"https://centrifugal.github.io/centrifugo/")," won't be available anymore. Documents may still be found ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/centrifugal/centrifugo/tree/gh-pages"},"on Github"),". Documentation for v3, v4 and v5 is hosted here."))}d.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=u(n),m=i,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||o;return n?r.createElement(f,a(a({ref:t},c),{},{components:n})):r.createElement(f,a({ref:t},c))}));function m(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,a=new Array(o);a[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,a[1]=l;for(var u=2;u<o;u++)a[u]=n[u];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"}}]);