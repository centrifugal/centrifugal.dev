"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[3073],{225:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=t(7462),i=(t(7294),t(3905));const a={id:"presence",title:"Online presence"},o=void 0,s={unversionedId:"server/presence",id:"version-4/server/presence",title:"Online presence",description:"The online presence feature of Centrifugo is a powerful tool that allows you to monitor and manage active users in real-time on a specific channel. It provides live data about which users are currently connected to your application.",source:"@site/versioned_docs/version-4/server/presence.md",sourceDirName:"server",slug:"/server/presence",permalink:"/docs/4/server/presence",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/versioned_docs/version-4/server/presence.md",tags:[],version:"4",frontMatter:{id:"presence",title:"Online presence"},sidebar:"Guides",previous:{title:"History and recovery",permalink:"/docs/4/server/history_and_recovery"},next:{title:"Admin web UI",permalink:"/docs/4/server/admin_web"}},l={},c=[{value:"Overview",id:"overview",level:2},{value:"Enabling Online Presence",id:"enabling-online-presence",level:2},{value:"Retrieving presence on the client side",id:"retrieving-presence-on-the-client-side",level:2},{value:"Join and leave events",id:"join-and-leave-events",level:2},{value:"Implementation notes",id:"implementation-notes",level:2},{value:"Conclusion",id:"conclusion",level:2}],p={toc:c};function u(e){let{components:n,...t}=e;return(0,i.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"The online presence feature of Centrifugo is a powerful tool that allows you to monitor and manage active users in real-time on a specific channel. It provides live data about which users are currently connected to your application."),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"Online presence provides an instantaneous snapshot of users currently connected to a specific channel. This information includes the user's unique ID and the connection timestamp."),(0,i.kt)("h2",{id:"enabling-online-presence"},"Enabling Online Presence"),(0,i.kt)("p",null,"To enable Online Presence, you need to set the ",(0,i.kt)("inlineCode",{parentName:"p"},"presence")," option to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," for the specific channel in your server configuration."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'{\n    "namespaces": [{\n        "namespace": "public",\n        "presence": true\n    }]\n}\n')),(0,i.kt)("p",null,"After enabling this you can query presence information over server HTTP/GRPC presence call:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl --header "Content-Type: application/json" \\\n  --header "Authorization: apikey YOUR_API_KEY" \\\n  --request POST \\\n  --data \'{"method": "presence", "params": {"channel": "public:test"}}\' \\\n  http://localhost:8000/api\n')),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"/docs/4/server/server_api#presence"},"description of presence API"),"."),(0,i.kt)("h2",{id:"retrieving-presence-on-the-client-side"},"Retrieving presence on the client side"),(0,i.kt)("p",null,"Once presence enabled, you can retrieve the presence information on the client side too by calling the presence method on the channel."),(0,i.kt)("p",null,"To do this you need to ",(0,i.kt)("a",{parentName:"p",href:"/docs/4/server/channel_permissions#presence-permission-model"},"give the client permission to call presence"),". Once done, presence may be retrieved from the subscription: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const presenceData = await subscription.presence(channel);\n")),(0,i.kt)("p",null,"It's also available on the top-level of the client (for example, if you need to call presence for server-side subscription):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const presenceData = await client.presence(channel);\n")),(0,i.kt)("p",null,"If the permission check has passed successfully \u2013 both methods will return an object containing information about currently subscribed clients."),(0,i.kt)("h2",{id:"join-and-leave-events"},"Join and leave events"),(0,i.kt)("p",null,"Online Presence feature also allows real-time tracking of users joining or leaving a channel by subscribing to ",(0,i.kt)("inlineCode",{parentName:"p"},"join")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"leave")," events:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"subscription.on('join', function(joinCtx) {\n    console.log('client joined:', joinCtx);\n});\n\nsubscription.on('leave', function(leaveCtx) {\n    console.log('client left:', leaveCtx);\n});\n")),(0,i.kt)("p",null,"And the same on ",(0,i.kt)("inlineCode",{parentName:"p"},"client")," top-level for the needs of server-side subscriptions (analogous to the presence call described above)."),(0,i.kt)("p",null,"These events provide real-time updates and can be used to keep track of user activity and manage live interactions."),(0,i.kt)("h2",{id:"implementation-notes"},"Implementation notes"),(0,i.kt)("p",null,"The Online Presence feature might increase the load on your Centrifugo server, since Centrifugo need to maintain an addition data structure. Therefore, it is recommended to use this feature judiciously based on your server's capability and the necessity of real-time presence data in your application."),(0,i.kt)("p",null,"Always make sure to secure the presence data, as it could expose sensitive information about user activity in your application. Ensure appropriate security measures are in place."),(0,i.kt)("p",null,"Join and leave events delivered with at most once guarantee."),(0,i.kt)("p",null,"See ",(0,i.kt)("a",{parentName:"p",href:"/docs/4/getting-started/design#online-presence-considerations"},"more about presence design")," in design overview chapter."),(0,i.kt)("p",null,"Also ",(0,i.kt)("a",{parentName:"p",href:"/docs/4/faq/#how-scalable-is-the-online-presence-and-joinleave-features"},"check out FAQ"),"."),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"The Online Presence feature of Centrifugo is a highly useful tool for real-time applications. It provides instant and live data about user activity, which can be critical for interactive features like chats, collaborative tools, multiplayer games, or live tracking systems. Make sure to configure and use this feature appropriately to get the most out of your real-time application."))}u.isMDXComponent=!0},3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>v});var r=t(7294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,i=function(e,n){if(null==e)return{};var t,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var l=r.createContext({}),c=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},p=function(e){var n=c(e.components);return r.createElement(l.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=c(t),v=i,m=d["".concat(l,".").concat(v)]||d[v]||u[v]||a;return t?r.createElement(m,o(o({ref:n},p),{},{components:t})):r.createElement(m,o({ref:n},p))}));function v(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=t.length,o=new Array(a);o[0]=d;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<a;c++)o[c]=t[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"}}]);