"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[7965],{85348:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>t,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>a});var s=n(85893),o=n(11151);const r={id:"channel_permissions",title:"Channel permission model"},c=void 0,l={id:"server/channel_permissions",title:"Channel permission model",description:"When using Centrifugo server API you don't need to think about channel permissions at all \u2013 everything is allowed. In server API case, request to Centrifugo must be issued by your application backend \u2013 so you have all the power to check any required permissions before issuing API request to Centrifugo.",source:"@site/docs/server/channel_permissions.md",sourceDirName:"server",slug:"/server/channel_permissions",permalink:"/docs/server/channel_permissions",draft:!1,unlisted:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/channel_permissions.md",tags:[],version:"current",frontMatter:{id:"channel_permissions",title:"Channel permission model"},sidebar:"Guides",previous:{title:"Channels and namespaces",permalink:"/docs/server/channels"},next:{title:"Channel JWT authorization",permalink:"/docs/server/channel_token_auth"}},t={},a=[{value:"Subscribe permission model",id:"subscribe-permission-model",level:3},{value:"Provide subscription token",id:"provide-subscription-token",level:4},{value:"Configure subscribe proxy",id:"configure-subscribe-proxy",level:4},{value:"Use user-limited channels",id:"use-user-limited-channels",level:4},{value:"Use allow_subscribe_for_client namespace option",id:"use-allow_subscribe_for_client-namespace-option",level:4},{value:"Subscribe capabilities in connection token",id:"subscribe-capabilities-in-connection-token",level:4},{value:"Subscribe capabilities in connect proxy",id:"subscribe-capabilities-in-connect-proxy",level:4},{value:"Publish permission model",id:"publish-permission-model",level:3},{value:"Use allow_publish_for_client namespace option",id:"use-allow_publish_for_client-namespace-option",level:4},{value:"Use allow_publish_for_subscriber namespace option",id:"use-allow_publish_for_subscriber-namespace-option",level:4},{value:"Configure publish proxy",id:"configure-publish-proxy",level:4},{value:"Publish capabilities in connection token",id:"publish-capabilities-in-connection-token",level:4},{value:"Publish capability in subscription token",id:"publish-capability-in-subscription-token",level:4},{value:"Publish capabilities in connect proxy",id:"publish-capabilities-in-connect-proxy",level:4},{value:"Publish capability in subscribe proxy",id:"publish-capability-in-subscribe-proxy",level:4},{value:"History permission model",id:"history-permission-model",level:3},{value:"Use allow_history_for_subscriber namespace option",id:"use-allow_history_for_subscriber-namespace-option",level:4},{value:"Use allow_history_for_client namespace option",id:"use-allow_history_for_client-namespace-option",level:4},{value:"History capabilities in connection token",id:"history-capabilities-in-connection-token",level:4},{value:"History capabilities in subscription token",id:"history-capabilities-in-subscription-token",level:4},{value:"History capabilities in connect proxy",id:"history-capabilities-in-connect-proxy",level:4},{value:"History capability in subscribe proxy response",id:"history-capability-in-subscribe-proxy-response",level:4},{value:"Presence permission model",id:"presence-permission-model",level:3},{value:"Presence capability in subscribe proxy response",id:"presence-capability-in-subscribe-proxy-response",level:4},{value:"Use allow_presence_for_subscriber namespace option",id:"use-allow_presence_for_subscriber-namespace-option",level:4},{value:"Use allow_presence_for_client namespace option",id:"use-allow_presence_for_client-namespace-option",level:4},{value:"Presence capabilities in connection token",id:"presence-capabilities-in-connection-token",level:4},{value:"Presence capabilities in subscription token",id:"presence-capabilities-in-subscription-token",level:4},{value:"Presence capabilities in connect proxy",id:"presence-capabilities-in-connect-proxy",level:4},{value:"Positioning permission model",id:"positioning-permission-model",level:3},{value:"Recovery permission model",id:"recovery-permission-model",level:3},{value:"Join/Leave permission model",id:"joinleave-permission-model",level:3}];function p(e){const i={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(i.p,{children:["When using Centrifugo ",(0,s.jsx)(i.a,{href:"/docs/server/server_api",children:"server API"})," you don't need to think about channel permissions at all \u2013 everything is allowed. In server API case, request to Centrifugo must be issued by your application backend \u2013 so you have all the power to check any required permissions before issuing API request to Centrifugo."]}),"\n",(0,s.jsx)(i.p,{children:"The situation is different when we are talking about client real-time API."}),"\n",(0,s.jsx)(i.p,{children:"In order to configure which client (i.e. connection established using one of supported bidirectional real-time transports) can subscribe to channels and call publish, history and presence real-time APIs Centrifugo provides several ways to configure the desired behavior."}),"\n",(0,s.jsx)(i.p,{children:"Let's start from looking at Centrifugo subscribe permission model."}),"\n",(0,s.jsx)(i.h3,{id:"subscribe-permission-model",children:"Subscribe permission model"}),"\n",(0,s.jsxs)(i.p,{children:["By default, client's attempt to subscribe on a channel will be rejected by a server with ",(0,s.jsx)(i.code,{children:"103: permission denied"})," error. There are several approaches how to control channel subscribe permissions:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#provide-subscription-token",children:"Provide subscription token"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#configure-subscribe-proxy",children:"Configure subscribe proxy"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#use-user-limited-channels",children:"Use user-limited channels"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#use-allow_subscribe_for_client-namespace-option",children:"Use subscribe_allowed_for_client namespace option"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#subscribe-capabilities-in-connection-token",children:"Subscribe capabilities in connection token"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#subscribe-capabilities-in-connect-proxy",children:"Subscribe capabilities in connect proxy"})}),"\n"]}),"\n",(0,s.jsx)(i.p,{children:"Below, we are describing those in detail."}),"\n",(0,s.jsx)(i.h4,{id:"provide-subscription-token",children:"Provide subscription token"}),"\n",(0,s.jsxs)(i.p,{children:["A client can provide a subscription token in subscribe request. See ",(0,s.jsx)(i.a,{href:"/docs/server/channel_token_auth",children:"the format of the token"}),"."]}),"\n",(0,s.jsxs)(i.p,{children:["If client provides a valid token then subscription will be accepted. In Centrifugo PRO subscription token can additionally grant ",(0,s.jsx)(i.code,{children:"publish"}),", ",(0,s.jsx)(i.code,{children:"history"})," and ",(0,s.jsx)(i.code,{children:"presence"})," permissions to a client."]}),"\n",(0,s.jsx)(i.admonition,{type:"caution",children:(0,s.jsxs)(i.p,{children:["For namespaces with ",(0,s.jsx)(i.code,{children:"allow_subscribe_for_client"})," option ON Centrifugo does not allow subscribing on channels starting with ",(0,s.jsx)(i.code,{children:"channel_private_prefix"})," (",(0,s.jsx)(i.code,{children:"$"})," by default) without token. This limitation exists to help users migrate to Centrifugo v4 without security risks."]})}),"\n",(0,s.jsx)(i.h4,{id:"configure-subscribe-proxy",children:"Configure subscribe proxy"}),"\n",(0,s.jsx)(i.p,{children:"If client subscribes on a namespace with configured subscribe proxy then depending on proxy response subscription will be accepted or not."}),"\n",(0,s.jsx)(i.p,{children:"If a namespace has configured subscribe proxy, but user came with a token \u2013 then subscribe proxy is not used, we are relying on token in this case. If a namespace has subscribe proxy, but user subscribes on a user-limited channel \u2013 then subscribe proxy is not used also."}),"\n",(0,s.jsx)(i.h4,{id:"use-user-limited-channels",children:"Use user-limited channels"}),"\n",(0,s.jsx)(i.p,{children:"If client subscribes on a user-limited channel and there is a user ID match then subscription will be accepted."}),"\n",(0,s.jsx)(i.admonition,{type:"caution",children:(0,s.jsxs)(i.p,{children:["User-limited channels must be enabled in a namespace using ",(0,s.jsx)(i.code,{children:"allow_user_limited_channels"})," option."]})}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_subscribe_for_client-namespace-option",children:"Use allow_subscribe_for_client namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_subscribe_for_client"})," allows all authenticated non-anonymous connections to subscribe on all channels in a namespace."]}),"\n",(0,s.jsx)(i.admonition,{type:"caution",children:(0,s.jsx)(i.p,{children:"Turning this option on effectively makes namespace public \u2013 no subscribe permissions will be checked (only the check that current connection is authenticated - i.e. has non-empty user ID). Make sure this is really what you want in terms of channels security."})}),"\n",(0,s.jsxs)(i.p,{children:["To additionally allow subscribing to anonymous connections take a look at ",(0,s.jsx)(i.code,{children:"allow_subscribe_for_anonymous"})," option."]}),"\n",(0,s.jsx)(i.h4,{id:"subscribe-capabilities-in-connection-token",children:"Subscribe capabilities in connection token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow user subscribe to channels."}),"\n",(0,s.jsx)(i.h4,{id:"subscribe-capabilities-in-connect-proxy",children:"Subscribe capabilities in connect proxy"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connect proxy can return capability object to allow user subscribe to channels."}),"\n",(0,s.jsx)(i.h3,{id:"publish-permission-model",children:"Publish permission model"}),"\n",(0,s.jsx)(i.admonition,{type:"tip",children:(0,s.jsx)(i.p,{children:"In idiomatic Centrifugo use case data should be published to channels from the application backend (over server API). In this case backend can validate data, save it into persistent storage before publishing in real-time towards connections. When publishing from the client-side backend does not receive publication data at all \u2013 it just goes through Centrifugo (except using publish proxy). There are cases when direct publications from the client-side are desired (like typing indicators in chat applications) though."})}),"\n",(0,s.jsxs)(i.p,{children:["By default, client's attempt to publish data into a channel will be rejected by a server with ",(0,s.jsx)(i.code,{children:"103: permission denied"})," error. There are several approaches how to control channel publish permissions:"]}),"\n",(0,s.jsxs)(i.ul,{children:["\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#configure-publish-proxy",children:"Configure publish proxy"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#use-allow_publish_for_subscriber-namespace-option",children:"Use allow_publish_for_subscriber namespace option"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#use-allow_publish_for_client-namespace-option",children:"Use allow_publish_for_client namespace option"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#publish-capabilities-in-connection-token",children:"Publish capabilities in connection token"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#publish-capability-in-subscription-token",children:"Publish capability in subscription token"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#publish-capabilities-in-connect-proxy",children:"Publish capabilities in connect proxy"})}),"\n",(0,s.jsx)(i.li,{children:(0,s.jsx)(i.a,{href:"#publish-capability-in-subscribe-proxy",children:"Publish capability in subscribe proxy"})}),"\n"]}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_publish_for_client-namespace-option",children:"Use allow_publish_for_client namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_publish_for_client"})," allows publications to channels of a namespace for all client connections."]}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_publish_for_subscriber-namespace-option",children:"Use allow_publish_for_subscriber namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_publish_for_subscriber"})," allows publications to channels of a namespace for all connections subscribed on a channel they want to publish data into."]}),"\n",(0,s.jsx)(i.h4,{id:"configure-publish-proxy",children:"Configure publish proxy"}),"\n",(0,s.jsx)(i.p,{children:"If client publishes to a namespace with configured publish proxy then depending on proxy response publication will be accepted or not."}),"\n",(0,s.jsx)(i.p,{children:"Configured publish proxy always used??? (what if user has permission in token or allow_publish_for_client?)"}),"\n",(0,s.jsx)(i.h4,{id:"publish-capabilities-in-connection-token",children:"Publish capabilities in connection token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow client to publish to channels."}),"\n",(0,s.jsx)(i.h4,{id:"publish-capability-in-subscription-token",children:"Publish capability in subscription token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow client to publish to a channel."}),"\n",(0,s.jsx)(i.h4,{id:"publish-capabilities-in-connect-proxy",children:"Publish capabilities in connect proxy"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connect proxy can return capability object to allow client publish to certain channels."}),"\n",(0,s.jsx)(i.h4,{id:"publish-capability-in-subscribe-proxy",children:"Publish capability in subscribe proxy"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Subscribe proxy can return capability object to allow subscriber publish to channel."}),"\n",(0,s.jsx)(i.h3,{id:"history-permission-model",children:"History permission model"}),"\n",(0,s.jsxs)(i.p,{children:["By default, client's attempt to call history from a channel (with history retention configured) will be rejected by a server with ",(0,s.jsx)(i.code,{children:"103: permission denied"})," error. There are several approaches how to control channel history permissions."]}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_history_for_subscriber-namespace-option",children:"Use allow_history_for_subscriber namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_history_for_subscriber"})," allows history requests to all channels in a namespace for all client connections subscribed on a channel they want to call history for."]}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_history_for_client-namespace-option",children:"Use allow_history_for_client namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_history_for_client"})," allows history requests to all channels in a namespace for all client connections."]}),"\n",(0,s.jsx)(i.h4,{id:"history-capabilities-in-connection-token",children:"History capabilities in connection token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow user call history for channels."}),"\n",(0,s.jsx)(i.h4,{id:"history-capabilities-in-subscription-token",children:"History capabilities in subscription token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow user call history from a channel."}),"\n",(0,s.jsx)(i.h4,{id:"history-capabilities-in-connect-proxy",children:"History capabilities in connect proxy"}),"\n",(0,s.jsx)(i.p,{children:(0,s.jsx)(i.strong,{children:"This is a Centrifugo PRO feature."})}),"\n",(0,s.jsx)(i.p,{children:"Connect proxy can return capability object to allow client call history from certain channels."}),"\n",(0,s.jsx)(i.h4,{id:"history-capability-in-subscribe-proxy-response",children:"History capability in subscribe proxy response"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Subscribe proxy can return capability object to allow subscriber call history from channel."}),"\n",(0,s.jsx)(i.h3,{id:"presence-permission-model",children:"Presence permission model"}),"\n",(0,s.jsxs)(i.p,{children:["By default, client's attempt to call presence from a channel (with channel presence configured) will be rejected by a server with ",(0,s.jsx)(i.code,{children:"103: permission denied"})," error. There are several approaches how to control channel presence permissions."]}),"\n",(0,s.jsx)(i.h4,{id:"presence-capability-in-subscribe-proxy-response",children:"Presence capability in subscribe proxy response"}),"\n",(0,s.jsx)(i.p,{children:"Subscribe proxy can return capability object to allow subscriber call presence from channel."}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_presence_for_subscriber-namespace-option",children:"Use allow_presence_for_subscriber namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_presence_for_subscriber"})," allows presence requests to all channels in a namespace for all client connections subscribed on a channel they want to call presence for."]}),"\n",(0,s.jsx)(i.h4,{id:"use-allow_presence_for_client-namespace-option",children:"Use allow_presence_for_client namespace option"}),"\n",(0,s.jsxs)(i.p,{children:[(0,s.jsx)(i.code,{children:"allow_presence_for_client"})," allows presence requests to all channels in a namespace for all client connections."]}),"\n",(0,s.jsx)(i.h4,{id:"presence-capabilities-in-connection-token",children:"Presence capabilities in connection token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow user call presence for channels."}),"\n",(0,s.jsx)(i.h4,{id:"presence-capabilities-in-subscription-token",children:"Presence capabilities in subscription token"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connection token can contain a capability object to allow user call presence of a channel."}),"\n",(0,s.jsx)(i.h4,{id:"presence-capabilities-in-connect-proxy",children:"Presence capabilities in connect proxy"}),"\n",(0,s.jsx)("p",{children:(0,s.jsx)("mark",{children:"Centrifugo PRO only"})}),"\n",(0,s.jsx)(i.p,{children:"Connect proxy can return capability object to allow client call presence from certain channels."}),"\n",(0,s.jsx)(i.h3,{id:"positioning-permission-model",children:"Positioning permission model"}),"\n",(0,s.jsxs)(i.p,{children:["Server can whether turn on positioning for all channels in a namespace using ",(0,s.jsx)(i.code,{children:'"force_positioning": true'})," option or client can create positioned subscriptions (but in this case client must have access to ",(0,s.jsx)(i.code,{children:"history"})," capability)."]}),"\n",(0,s.jsx)(i.h3,{id:"recovery-permission-model",children:"Recovery permission model"}),"\n",(0,s.jsxs)(i.p,{children:["Server can whether turn on automatic recovery for all channels in a namespace using ",(0,s.jsx)(i.code,{children:'"force_recovery": true'})," option or client can create recoverable subscriptions (but in this case client must have access to ",(0,s.jsx)(i.code,{children:"history"})," capability)."]}),"\n",(0,s.jsx)(i.h3,{id:"joinleave-permission-model",children:"Join/Leave permission model"}),"\n",(0,s.jsxs)(i.p,{children:["Server can whether force sending join/leave messages to all subscribers for all channels in a namespace using ",(0,s.jsx)(i.code,{children:'"force_push_join_leave": true'})," option or client can ask server to include join/leave messages upon subscribing (but in this case client must have access to ",(0,s.jsx)(i.code,{children:"presence"})," capability)."]})]})}function h(e={}){const{wrapper:i}={...(0,o.a)(),...e.components};return i?(0,s.jsx)(i,{...e,children:(0,s.jsx)(p,{...e})}):p(e)}},11151:(e,i,n)=>{n.d(i,{Z:()=>l,a:()=>c});var s=n(67294);const o={},r=s.createContext(o);function c(e){const i=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function l(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),s.createElement(r.Provider,{value:i},e.children)}}}]);