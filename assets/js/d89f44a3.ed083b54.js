"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[9042],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>c});var s=i(96540);const r={},t=s.createContext(r);function o(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(t.Provider,{value:n},e.children)}},41378:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"server/presence","title":"Online presence","description":"The online presence feature in Centrifugo is a powerful tool for monitoring and managing active users within a specific channel. It provides a real-time view of users currently subscribed to that channel. Additionally, Centrifugo can emit join and leave events to all channel subscribers whenever clients subscribe to or unsubscribe from a channel, allowing you to track user activity more effectively.","source":"@site/versioned_docs/version-5/server/presence.md","sourceDirName":"server","slug":"/server/presence","permalink":"/docs/5/server/presence","draft":false,"unlisted":false,"editUrl":"https://github.com/centrifugal/centrifugal.dev/edit/main/versioned_docs/version-5/server/presence.md","tags":[],"version":"5","frontMatter":{"id":"presence","title":"Online presence"},"sidebar":"Guides","previous":{"title":"Delta compression","permalink":"/docs/5/server/delta_compression"},"next":{"title":"Proxy events to the backend","permalink":"/docs/5/server/proxy"}}');var r=i(74848),t=i(28453);const o={id:"presence",title:"Online presence"},c=void 0,a={},l=[{value:"Enabling online presence",id:"enabling-online-presence",level:2},{value:"Retrieving presence on the client side",id:"retrieving-presence-on-the-client-side",level:2},{value:"Connection and channel custom info",id:"connection-and-channel-custom-info",level:2},{value:"Join and leave events",id:"join-and-leave-events",level:2},{value:"Implementation notes",id:"implementation-notes",level:2},{value:"Conclusion",id:"conclusion",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"The online presence feature in Centrifugo is a powerful tool for monitoring and managing active users within a specific channel. It provides a real-time view of users currently subscribed to that channel. Additionally, Centrifugo can emit join and leave events to all channel subscribers whenever clients subscribe to or unsubscribe from a channel, allowing you to track user activity more effectively."}),"\n",(0,r.jsx)(n.h2,{id:"enabling-online-presence",children:"Enabling online presence"}),"\n",(0,r.jsxs)(n.p,{children:["To enable online presence, you need to set the ",(0,r.jsx)(n.code,{children:"presence"})," option to ",(0,r.jsx)(n.code,{children:"true"})," for the specific channel namespace in your Centrifugo configuration."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "namespaces": [{\n        "name": "public",\n        "presence": true\n    }]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"After enabling this you can query presence information over server HTTP/GRPC presence call:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl --header "Content-Type: application/json" \\\n  --header "X-API-Key: YOUR_API_KEY" \\\n  --request POST \\\n  --data \'{"channel": "public:test"}\' \\\n  http://localhost:8000/api/presence\n'})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/5/server/server_api#presence",children:"description of presence API"}),"."]}),"\n",(0,r.jsx)(n.p,{children:"Also, a shorter version of presence which only contains two counters - number of clients and number of unique users in channel - may be called:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'curl --header "Content-Type: application/json" \\\n  --header "X-API-Key: YOUR_API_KEY" \\\n  --request POST \\\n  --data \'{"channel": "public:test"}\' \\\n  http://localhost:8000/api/presence_stats\n'})}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/5/server/server_api#presence_stats",children:"description of presence stats API"}),"."]}),"\n",(0,r.jsx)(n.h2,{id:"retrieving-presence-on-the-client-side",children:"Retrieving presence on the client side"}),"\n",(0,r.jsx)(n.p,{children:"Once presence enabled, you can retrieve the presence information on the client side too by calling the presence method on the channel."}),"\n",(0,r.jsxs)(n.p,{children:["To do this you need to ",(0,r.jsx)(n.a,{href:"/docs/5/server/channel_permissions#presence-permission-model",children:"give the client permission to call presence"}),". Once done, presence may be retrieved from the subscription:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.presence(channel);\n"})}),"\n",(0,r.jsx)(n.p,{children:"It's also available on the top-level of the client (for example, if you need to call presence for server-side subscription):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const resp = await client.presence(channel);\n"})}),"\n",(0,r.jsx)(n.p,{children:"If the permission check has passed successfully \u2013 both methods will return an object containing information about currently subscribed clients."}),"\n",(0,r.jsxs)(n.p,{children:["Also, ",(0,r.jsx)(n.code,{children:"presenceStats"})," method is avalable:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.presenceStats(channel);\n"})}),"\n",(0,r.jsx)(n.h2,{id:"connection-and-channel-custom-info",children:"Connection and channel custom info"}),"\n",(0,r.jsxs)(n.p,{children:["It's possible to extend presence information with ",(0,r.jsx)(n.code,{children:"info"})," (connection-wide) and ",(0,r.jsx)(n.code,{children:"chan_info"})," (channel specific) additional information."]}),"\n",(0,r.jsxs)(n.p,{children:["For connection wide ",(0,r.jsx)(n.code,{children:"info"})," data may be taken by Centrifugo from:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["connection token ",(0,r.jsx)(n.a,{href:"https://centrifugal.dev/docs/server/authentication#info",children:"info"})," claim"]}),"\n",(0,r.jsxs)(n.li,{children:["connect proxy ",(0,r.jsx)(n.a,{href:"https://centrifugal.dev/docs/server/proxy#connect-result-fields",children:"result"})," ",(0,r.jsx)(n.code,{children:"info"})," field"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["For channel-specific ",(0,r.jsx)(n.code,{children:"chan_info"}),":"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["from subscription token ",(0,r.jsx)(n.a,{href:"https://centrifugal.dev/docs/server/channel_token_auth#info",children:"info"})," claim"]}),"\n",(0,r.jsxs)(n.li,{children:["from subscribe proxy ",(0,r.jsx)(n.a,{href:"https://centrifugal.dev/docs/server/proxy#subscribe-result-fields",children:"result"})," ",(0,r.jsx)(n.code,{children:"info"})," field"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["After adding additional information you will receive ",(0,r.jsx)(n.code,{children:"info"})," and ",(0,r.jsx)(n.code,{children:"chan_info"})," in presence responses."]}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"Be careful to not expose specific connection sensitive data with all other users in channel."})}),"\n",(0,r.jsxs)(n.p,{children:["Both ",(0,r.jsx)(n.code,{children:"info"})," and ",(0,r.jsx)(n.code,{children:"chan_info"})," once specified will be also attached to join and leave events."]}),"\n",(0,r.jsx)(n.h2,{id:"join-and-leave-events",children:"Join and leave events"}),"\n",(0,r.jsxs)(n.p,{children:["It's also possible to enable real-time tracking of users joining or leaving a channel by listening to ",(0,r.jsx)(n.code,{children:"join"})," and ",(0,r.jsx)(n.code,{children:"leave"})," events on the client side."]}),"\n",(0,r.jsx)(n.p,{children:"By default, Centrifugo does not send these events and they must be explicitly turned on for channel namespace:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n    "namespaces": [{\n        "name": "public",\n        "presence": true,\n        "join_leave": true,\n        "force_push_join_leave": true\n    }]\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Then on the client side:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-javascript",children:"subscription.on('join', function(joinCtx) {\n    console.log('client joined:', joinCtx);\n});\n\nsubscription.on('leave', function(leaveCtx) {\n    console.log('client left:', leaveCtx);\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["And the same on ",(0,r.jsx)(n.code,{children:"client"})," top-level for the needs of server-side subscriptions (analogous to the presence call described above)."]}),"\n",(0,r.jsx)(n.p,{children:"These events provide real-time updates and can be used to keep track of user activity and manage live interactions."}),"\n",(0,r.jsx)(n.p,{children:"You can combine join/leave events with presence information and maintain a list of currently active subscribers - for example show the list of online players in the game room updated in real-time."}),"\n",(0,r.jsx)(n.h2,{id:"implementation-notes",children:"Implementation notes"}),"\n",(0,r.jsx)(n.p,{children:"The online presence feature might increase the load on your Centrifugo server, since Centrifugo need to maintain an addition data structure. Therefore, it is recommended to use this feature judiciously based on your server's capability and the necessity of real-time presence data in your application."}),"\n",(0,r.jsx)(n.p,{children:"Always make sure to secure the presence data, as it could expose sensitive information about user activity in your application. Ensure appropriate security measures are in place."}),"\n",(0,r.jsx)(n.p,{children:"Join and leave events delivered with at most once guarantee."}),"\n",(0,r.jsxs)(n.p,{children:["See ",(0,r.jsx)(n.a,{href:"/docs/5/getting-started/design#online-presence-considerations",children:"more about presence design"})," in design overview chapter."]}),"\n",(0,r.jsxs)(n.p,{children:["Also ",(0,r.jsx)(n.a,{href:"/docs/5/faq/#how-scalable-is-the-online-presence-and-joinleave-features",children:"check out FAQ"})," which mentions scalability concerns for presence data and join/leave events."]}),"\n",(0,r.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,r.jsx)(n.p,{children:"The online presence feature of Centrifugo is a highly useful tool for real-time applications. It provides instant and live data about user activity, which can be critical for interactive features in chats, collaborative tools, multiplayer games, or live tracking systems. Make sure to configure and use this feature appropriately to get the most out of your real-time application."})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);