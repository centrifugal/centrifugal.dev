"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[4074],{28453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>o});var t=s(96540);const i={},c=t.createContext(i);function r(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(c.Provider,{value:n},e.children)}},51801:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"transports/uni_websocket","title":"Unidirectional WebSocket","description":"Default unidirectional WebSocket connection endpoint in Centrifugo is:","source":"@site/versioned_docs/version-5/transports/uni_websocket.md","sourceDirName":"transports","slug":"/transports/uni_websocket","permalink":"/docs/5/transports/uni_websocket","draft":false,"unlisted":false,"editUrl":"https://github.com/centrifugal/centrifugal.dev/edit/main/versioned_docs/version-5/transports/uni_websocket.md","tags":[],"version":"5","frontMatter":{"id":"uni_websocket","title":"Unidirectional WebSocket","sidebar_label":"WebSocket"},"sidebar":"Transports","previous":{"title":"Unidirectional protocol","permalink":"/docs/5/transports/uni_client_protocol"},"next":{"title":"HTTP streaming","permalink":"/docs/5/transports/uni_http_stream"}}');var i=s(74848),c=s(28453);const r={id:"uni_websocket",title:"Unidirectional WebSocket",sidebar_label:"WebSocket"},o=void 0,d={},l=[{value:"Connect command",id:"connect-command",level:2},{value:"SubscribeRequest",id:"subscriberequest",level:3},{value:"Supported data formats",id:"supported-data-formats",level:2},{value:"Pings",id:"pings",level:2},{value:"Options",id:"options",level:2},{value:"uni_websocket",id:"uni_websocket",level:3},{value:"uni_websocket_message_size_limit",id:"uni_websocket_message_size_limit",level:3},{value:"Example",id:"example",level:2}];function a(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,c.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"Default unidirectional WebSocket connection endpoint in Centrifugo is:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"/connection/uni_websocket\n"})}),"\n",(0,i.jsx)(n.p,{children:"While WebSocket is bidirectional transport in its nature Centrifugo provides its unidirectional version too to give developers more choice in transports when using unidirectional approach."}),"\n",(0,i.jsx)(n.h2,{id:"connect-command",children:"Connect command"}),"\n",(0,i.jsx)(n.p,{children:"It's possible to send connect command as first WebSocket message (as JSON)."}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field name"}),(0,i.jsx)(n.th,{children:"Field type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"token"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"Connection JWT, not required when using the connect proxy feature."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"data"}),(0,i.jsx)(n.td,{children:"any JSON"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"Custom JSON connection data"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"name"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"Application name"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"version"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"Application version"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"subs"}),(0,i.jsx)(n.td,{children:"map of channel to SubscribeRequest"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"Pass an information about desired subscriptions to a server"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"subscriberequest",children:"SubscribeRequest"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Field name"}),(0,i.jsx)(n.th,{children:"Field type"}),(0,i.jsx)(n.th,{children:"Required"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"recover"}),(0,i.jsx)(n.td,{children:"boolean"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsx)(n.td,{children:"Whether a client wants to recover from a certain position"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"offset"}),(0,i.jsx)(n.td,{children:"integer"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["Known stream position offset when ",(0,i.jsx)(n.code,{children:"recover"})," is used"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"epoch"}),(0,i.jsx)(n.td,{children:"string"}),(0,i.jsx)(n.td,{children:"no"}),(0,i.jsxs)(n.td,{children:["Known stream position epoch when ",(0,i.jsx)(n.code,{children:"recover"})," is used"]})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"supported-data-formats",children:"Supported data formats"}),"\n",(0,i.jsx)(n.p,{children:"JSON"}),"\n",(0,i.jsx)(n.h2,{id:"pings",children:"Pings"}),"\n",(0,i.jsxs)(n.p,{children:["Centrifugo uses empty commands (",(0,i.jsx)(n.code,{children:"{}"})," in JSON case) as pings for unidirectional WS. You can ignore such messages or use them to detect broken connections (nothing received from a server for a long time)."]}),"\n",(0,i.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,i.jsx)(n.h3,{id:"uni_websocket",children:"uni_websocket"}),"\n",(0,i.jsxs)(n.p,{children:["Boolean, default: ",(0,i.jsx)(n.code,{children:"false"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Enables unidirectional WebSocket endpoint."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n    ...\n    "uni_websocket": true\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"uni_websocket_message_size_limit",children:"uni_websocket_message_size_limit"}),"\n",(0,i.jsx)(n.p,{children:"Default: 65536 (64KB)"}),"\n",(0,i.jsx)(n.p,{children:"Maximum allowed size of a first connect message received from WebSocket connection in bytes."}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsxs)(n.p,{children:["Let's connect to a unidirectional WebSocket endpoint using ",(0,i.jsx)(n.a,{href:"https://github.com/websockets/wscat",children:"wscat"})," tool \u2013 it allows connecting to WebSocket servers interactively from a terminal."]}),"\n",(0,i.jsxs)(n.p,{children:["First, run Centrifugo with ",(0,i.jsx)(n.code,{children:"uni_websocket"})," enabled. Also let's enable automatic personal channel subscriptions for users. Configuration example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",metastring:'title="config.json"',children:'{\n  "token_hmac_secret_key": "secret",\n  "uni_websocket":true,\n  "user_subscribe_to_personal": true\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Run Centrifugo:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"./centrifugo -c config.json\n"})}),"\n",(0,i.jsx)(n.p,{children:"In another terminal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u276f ./centrifugo gentoken -c config.json -u test_user\nHMAC SHA-256 JWT for user test_user with expiration TTL 168h0m0s:\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0X3VzZXIiLCJleHAiOjE2MzAxMzAxNzB9.u7anX-VYXywX1p1lv9UC9CAu04vpA6LgG5gsw5lz1Iw\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Install ",(0,i.jsx)(n.a,{href:"https://github.com/websockets/wscat",children:"wscat"})," and run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'wscat -c "ws://localhost:8000/connection/uni_websocket"\n'})}),"\n",(0,i.jsx)(n.p,{children:"This will establish a connection with a server and you then can send connect command to a server:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\u276f wscat -c "ws://localhost:8000/connection/uni_websocket"\n\nConnected (press CTRL+C to quit)\n> {"token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJ0ZXN0X3VzZXIiLCJleHAiOjE2NTY1MDMwNDV9.3UYL-UCUBp27TybeBK7Z0OenwdsKwCMRe46fuEjJnzI", "subs": {"abc": {}}}\n< {"connect":{"client":"bfd28799-b958-4791-b9e9-b011eaef68c1","version":"0.0.0","subs":{"#test_user":{}},"expires":true,"ttl":604407,"ping":25,"session":"57b1287b-44ec-45c8-93fc-696c5294af25"}}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The connection will receive server pings (empty commands ",(0,i.jsx)(n.code,{children:"{}"}),") periodically. You can try to publish something to ",(0,i.jsx)(n.code,{children:"#test_user"})," or ",(0,i.jsx)(n.code,{children:"abc"})," channels (using Centrifugo server API or using admin UI) \u2013 and the message should come to the connection we just established."]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}}}]);