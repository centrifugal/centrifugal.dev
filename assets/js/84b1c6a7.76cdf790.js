"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[6e3],{62613:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>c,metadata:()=>o,toc:()=>l});var t=s(85893),i=s(11151);const c={id:"client_api",title:"Client API showcase"},r=void 0,o={id:"getting-started/client_api",title:"Client API showcase",description:"This chapter showcases the capabilities of Centrifugo's bidirectional client API \u2013 i.e., the real-time messaging primitives available on the front end (which can be a browser or a mobile device).",source:"@site/docs/getting-started/client_api.md",sourceDirName:"getting-started",slug:"/getting-started/client_api",permalink:"/docs/getting-started/client_api",draft:!1,unlisted:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/getting-started/client_api.md",tags:[],version:"current",frontMatter:{id:"client_api",title:"Client API showcase"}},a={},l=[{value:"Connecting to a server",id:"connecting-to-a-server",level:2},{value:"Disconnecting from a server",id:"disconnecting-from-a-server",level:2},{value:"Reconnecting to a server",id:"reconnecting-to-a-server",level:2},{value:"Connection lifecycle events",id:"connection-lifecycle-events",level:2},{value:"Subscribe to a channel",id:"subscribe-to-a-channel",level:2},{value:"Server-side subscriptions",id:"server-side-subscriptions",level:2},{value:"Send RPC",id:"send-rpc",level:2},{value:"Call channel history",id:"call-channel-history",level:2},{value:"Presence and presence stats",id:"presence-and-presence-stats",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"This chapter showcases the capabilities of Centrifugo's bidirectional client API \u2013 i.e., the real-time messaging primitives available on the front end (which can be a browser or a mobile device)."}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"It is also possible to avoid using the client library at all with unidirectional transports (../transports/overview.md)."})}),"\n",(0,t.jsxs)(n.p,{children:["This is a formal description \u2013 we use the JavaScript client ",(0,t.jsx)(n.code,{children:"centrifuge-js"})," for examples here. Refer to each specific client implementation for concrete method names and possibilities. See the ",(0,t.jsx)(n.a,{href:"/docs/transports/client_sdk",children:"full list of Centrifugo client SDKs"}),". This description does not cover all protocol possibilities \u2013 just the most important ones to start with."]}),"\n",(0,t.jsxs)(n.p,{children:["If you are looking for detailed information about the client-server protocol internals, then the ",(0,t.jsx)(n.a,{href:"/docs/transports/client_protocol",children:"client protocol description"})," chapter can help."]}),"\n",(0,t.jsx)(n.h2,{id:"connecting-to-a-server",children:"Connecting to a server"}),"\n",(0,t.jsx)(n.p,{children:"Each Centrifugo client allows connecting to a server."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const centrifuge = new Centrifuge('ws://localhost:8000/connection/websocket');\ncentrifuge.connect();\n"})}),"\n",(0,t.jsx)(n.p,{children:"In most cases you will need to pass JWT (JSON Web Token) for authentication, so the example above transforms to:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const centrifuge = new Centrifuge('ws://localhost:8000/connection/websocket');\ncentrifuge.setToken('<USER-JWT>')\ncentrifuge.connect();\n"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/docs/server/authentication",children:"authentication"})," chapter for more information on how to generate connection JWT."]}),"\n",(0,t.jsxs)(n.p,{children:["If you are using ",(0,t.jsx)(n.a,{href:"/docs/server/proxy#connect-proxy",children:"connect proxy"})," then you may go without setting JWT."]}),"\n",(0,t.jsx)(n.h2,{id:"disconnecting-from-a-server",children:"Disconnecting from a server"}),"\n",(0,t.jsx)(n.p,{children:"After connecting you can disconnect from a server at any moment."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"centrifuge.disconnect();\n"})}),"\n",(0,t.jsx)(n.h2,{id:"reconnecting-to-a-server",children:"Reconnecting to a server"}),"\n",(0,t.jsx)(n.p,{children:"Centrifugo clients automatically reconnect to a server in case of temporary connection loss, also clients periodically ping the server to detect broken connections."}),"\n",(0,t.jsx)(n.h2,{id:"connection-lifecycle-events",children:"Connection lifecycle events"}),"\n",(0,t.jsx)(n.p,{children:"All client implementations allow setting handlers on connect and disconnect events."}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"centrifuge.on('connect', function(connectCtx){\n    console.log('connected', connectCtx)\n});\n\ncentrifuge.on('disconnect', function(disconnectCtx){\n    console.log('disconnected', disconnectCtx)\n});\n"})}),"\n",(0,t.jsx)(n.h2,{id:"subscribe-to-a-channel",children:"Subscribe to a channel"}),"\n",(0,t.jsx)(n.p,{children:"Another core functionality of client API is the possibility to subscribe to a channel to receive all messages published to that channel."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"centrifuge.subscribe('channel', function(messageCtx) {\n    console.log(messageCtx);\n})\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Clients can subscribe to ",(0,t.jsx)(n.a,{href:"/docs/server/channels",children:"different channels"}),". The subscribe method returns the ",(0,t.jsx)(n.code,{children:"Subscription"})," object. It's also possible to react to different Subscription events: join and leave events, subscribe success and subscribe error events, unsubscribe events."]}),"\n",(0,t.jsxs)(n.p,{children:["In the idiomatic case, messages are published to channels from the application backend ",(0,t.jsx)(n.a,{href:"/docs/server/server_api",children:"over the Centrifugo server API"}),". However, this is not always the case."]}),"\n",(0,t.jsxs)(n.p,{children:["Centrifugo also provides a message recovery feature to restore missed publications in channels. Publications can be missed due to temporary disconnects (bad network) or server reloads. Recovery happens automatically on reconnect (due to bad network or server reloads) as soon as recovery in the channel is ",(0,t.jsx)(n.a,{href:"/docs/server/channels#channel-options",children:"properly configured"}),". The client keeps the last seen Publication offset and restores missed publications since the known offset upon reconnecting. If recovery fails, then the client implementation provides a flag inside the subscribe event to let the application know that some publications were missed \u2013 so you may need to load the state from scratch from the application backend. Not all Centrifugo clients implement a recovery feature \u2013 refer to specific client implementation docs. More details about recovery can be found in ",(0,t.jsx)(n.a,{href:"/docs/server/history_and_recovery",children:"a dedicated chapter"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"server-side-subscriptions",children:"Server-side subscriptions"}),"\n",(0,t.jsxs)(n.p,{children:["To handle publications coming from ",(0,t.jsx)(n.a,{href:"/docs/server/server_subs",children:"server-side subscriptions"})," client API allows listening publications simply on Centrifuge client instance:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"centrifuge.on('publish', function(messageCtx) {\n    console.log(messageCtx);\n});\n"})}),"\n",(0,t.jsx)(n.p,{children:"It's also possible to react on different server-side Subscription events: join and leave events, subscribe success, unsubscribe event. There is no subscribe error event here since the subscription was initiated on the server-side."}),"\n",(0,t.jsx)(n.h2,{id:"send-rpc",children:"Send RPC"}),"\n",(0,t.jsxs)(n.p,{children:["A client can send an RPC to the server. RPC is a call that is not related to channels at all. It's just a way to call a server method from the client side over the WebSocket or SockJS connection. RPC is only available when an ",(0,t.jsx)(n.a,{href:"/docs/server/proxy#rpc-proxy",children:"RPC proxy"})," is configured."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const rpcRequest = {'key': 'value'};\nconst data = await centrifuge.namedRPC('example_method', rpcRequest);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"call-channel-history",children:"Call channel history"}),"\n",(0,t.jsxs)(n.p,{children:["Once subscribed client can call publication history inside a channel (only for channels where ",(0,t.jsx)(n.a,{href:"/docs/server/channels#channel-options",children:"history configured"}),") to get last publications in channel:"]}),"\n",(0,t.jsx)(n.p,{children:"Get stream current top position:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.history();\nconsole.log(resp.offset);\nconsole.log(resp.epoch);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Get up to 10 publications from history since known stream position:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.history({limit: 10, since: {offset: 0, epoch: '...'}});\nconsole.log(resp.publications);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Get up to 10 publications from history since current stream beginning:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.history({limit: 10});\nconsole.log(resp.publications);\n"})}),"\n",(0,t.jsx)(n.p,{children:"Get up to 10 publications from history since current stream end in reversed order (last to first):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.history({limit: 10, reverse: true});\nconsole.log(resp.publications);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"presence-and-presence-stats",children:"Presence and presence stats"}),"\n",(0,t.jsxs)(n.p,{children:["Once subscribed client can call presence and presence stats information inside channel (only for channels where ",(0,t.jsx)(n.a,{href:"/docs/server/channels#channel-options",children:"presence configured"}),"):"]}),"\n",(0,t.jsx)(n.p,{children:"For presence (full information about active subscribers in channel):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.presence();\n// resp contains presence information - a map client IDs as keys \n// and client information as values.\n"})}),"\n",(0,t.jsx)(n.p,{children:"For presence stats (just a number of clients and unique users in a channel):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"const resp = await subscription.presenceStats();\n// resp contains a number of clients and a number of unique users.\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},11151:(e,n,s)=>{s.d(n,{Z:()=>o,a:()=>r});var t=s(67294);const i={},c=t.createContext(i);function r(e){const n=t.useContext(c);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(c.Provider,{value:n},e.children)}}}]);