"use strict";(self.webpackChunkcentrifugal_dev=self.webpackChunkcentrifugal_dev||[]).push([[3655],{7175:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var o=n(7462),r=(n(7294),n(3905));const s={id:"sockjs",title:"SockJS"},a=void 0,i={unversionedId:"transports/sockjs",id:"transports/sockjs",title:"SockJS",description:"SockJS is a polyfill browser library which provides HTTP-based fallback transports in case when it's not possible to establish Websocket connection. This can happen in old client browsers or because of some proxy behind client and server that cuts of Websocket traffic. You can find more information on SockJS project Github page.",source:"@site/docs/transports/sockjs.md",sourceDirName:"transports",slug:"/transports/sockjs",permalink:"/docs/transports/sockjs",draft:!1,editUrl:"https://github.com/centrifugal/centrifugal.dev/edit/main/docs/transports/sockjs.md",tags:[],version:"current",frontMatter:{id:"sockjs",title:"SockJS"},sidebar:"Transports",previous:{title:"SSE (EventSource)",permalink:"/docs/transports/sse"},next:{title:"WebTransport",permalink:"/docs/transports/webtransport"}},c={},l=[{value:"SockJS caveats",id:"sockjs-caveats",level:2},{value:"Sticky sessions",id:"sticky-sessions",level:3},{value:"Browser only",id:"browser-only",level:3},{value:"JSON only",id:"json-only",level:3},{value:"Options",id:"options",level:2},{value:"sockjs",id:"sockjs",level:3},{value:"sockjs_url",id:"sockjs_url",level:3}],p={toc:l};function u(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"SockJS is a polyfill browser library which provides HTTP-based fallback transports in case when it's not possible to establish Websocket connection. This can happen in old client browsers or because of some proxy behind client and server that cuts of Websocket traffic. You can find more information on ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/sockjs/sockjs-client"},"SockJS project Github page"),"."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"SockJS transport is DEPRECATED. It ",(0,r.kt)("a",{parentName:"p",href:"https://centrifugal.dev/blog/2023/06/29/centrifugo-v5-released#the-future-of-sockjs"},"may be removed")," in the next major releases. Consider using our own WebSocket emulation layer based on HTTP-streaming and EventSource instead. If you know a use case where SockJS is still prefferred \u2013 reach us out to discuss this use case. ")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"This transport is only implemented by our Javascript SDK at this point \u2013 as it mostly makes sense as a fallback for WebSocket to have real-time connection in an environment where WebSocket is unavailable. These days those envs are mostly corporate networks which can block WebSocket traffic (even TLS-based).")),(0,r.kt)("p",null,"If you have a requirement to work everywhere SockJS is the solution. SockJS will automatically choose best fallback transport if Websocket connection failed for some reason. Some of the fallback transports are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"EventSource (SSE)"),(0,r.kt)("li",{parentName:"ul"},"XHR-streaming"),(0,r.kt)("li",{parentName:"ul"},"Long-polling"),(0,r.kt)("li",{parentName:"ul"},"And more (see ",(0,r.kt)("a",{parentName:"li",href:"https://github.com/sockjs/sockjs-client"},"SockJS docs"),")")),(0,r.kt)("p",null,"SockJS connection endpoint in Centrifugo is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"/connection/sockjs\n")),(0,r.kt)("h2",{id:"sockjs-caveats"},"SockJS caveats"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"There are several important caveats to know when using SockJS \u2013 see below.")),(0,r.kt)("h3",{id:"sticky-sessions"},"Sticky sessions"),(0,r.kt)("p",null,"First is that you need to use sticky sessions mechanism if you have ",(0,r.kt)("strong",{parentName:"p"},"more than one")," Centrifugo nodes running behind a load balancer. This mechanism usually supported by load balancers (for example Nginx). Sticky sessions mean that all requests from the same client will come to the same Centrifugo node. This is necessary because SockJS maintains connection session in process memory thus allowing bidirectional communication between a client and a server. Sticky mechanism not required if you only use one Centrifugo node on a backend."),(0,r.kt)("p",null,"For example, with Nginx sticky support can be enabled with ",(0,r.kt)("inlineCode",{parentName:"p"},"ip_hash")," directive for upstream:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"upstream centrifugo {\n    ip_hash;\n    server 127.0.0.1:8000;\n    server 127.0.0.2:8000;\n}\n")),(0,r.kt)("p",null,"With this configuration Nginx will proxy connections with the same ip address to the same upstream backend."),(0,r.kt)("p",null,"But ",(0,r.kt)("inlineCode",{parentName:"p"},"ip_hash;")," is not the best choice in this case, because there could be situations\nwhere a lot of different connections are coming with the same IP address (behind proxies)\nand the load balancing system won't be fair."),(0,r.kt)("p",null,"So the best solution would be using something like ",(0,r.kt)("a",{parentName:"p",href:"https://bitbucket.org/nginx-goodies/nginx-sticky-module-ng/overview"},"nginx-sticky-module")," which uses setting a special cookie to track the upstream server for a client."),(0,r.kt)("h3",{id:"browser-only"},"Browser only"),(0,r.kt)("p",null,"SockJS is only supported by centrifuge-js \u2013 i.e. our browser client. There is no much sense to use SockJS outside of a browser these days."),(0,r.kt)("h3",{id:"json-only"},"JSON only"),(0,r.kt)("p",null,"One more thing to be aware of is that SockJS does not support binary data, so there is no option to use Centrifugo Protobuf protocol on top of SockJS (unlike WebSocket). Only JSON payloads can be transferred."),(0,r.kt)("h2",{id:"options"},"Options"),(0,r.kt)("h3",{id:"sockjs"},"sockjs"),(0,r.kt)("p",null,"Boolean, default: ",(0,r.kt)("inlineCode",{parentName:"p"},"false"),"."),(0,r.kt)("p",null,"Enables SockJS transport."),(0,r.kt)("h3",{id:"sockjs_url"},"sockjs_url"),(0,r.kt)("p",null,"Default: ",(0,r.kt)("inlineCode",{parentName:"p"},"https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js")),(0,r.kt)("p",null,"Link to SockJS url which is required when iframe-based HTTP fallbacks are in use."))}u.isMDXComponent=!0},3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?s(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=o.createContext({}),l=function(e){var t=o.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},p=function(e){var t=l(e.components);return o.createElement(c.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},k=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,c=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),k=l(n),d=r,m=k["".concat(c,".").concat(d)]||k[d]||u[d]||s;return n?o.createElement(m,a(a({ref:t},p),{},{components:n})):o.createElement(m,a({ref:t},p))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,a=new Array(s);a[0]=k;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i.mdxType="string"==typeof e?e:r,a[1]=i;for(var l=2;l<s;l++)a[l]=n[l];return o.createElement.apply(null,a)}return o.createElement.apply(null,n)}k.displayName="MDXCreateElement"}}]);