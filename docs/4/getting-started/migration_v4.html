<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-4 docs-doc-page docs-doc-id-getting-started/migration_v4" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Migrating to v4 | Centrifugo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://centrifugal.dev/img/centrifugo_soc.png"><meta data-rh="true" name="twitter:image" content="https://centrifugal.dev/img/centrifugo_soc.png"><meta data-rh="true" property="og:url" content="https://centrifugal.dev/docs/4/getting-started/migration_v4"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="4"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4"><meta data-rh="true" name="docsearch:version" content="4"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4"><meta data-rh="true" property="og:title" content="Migrating to v4 | Centrifugo"><meta data-rh="true" name="description" content="Centrifugo v4 development was concentrated around two main things:"><meta data-rh="true" property="og:description" content="Centrifugo v4 development was concentrated around two main things:"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://centrifugal.dev/docs/4/getting-started/migration_v4"><link data-rh="true" rel="alternate" href="https://centrifugal.dev/docs/4/getting-started/migration_v4" hreflang="en"><link data-rh="true" rel="alternate" href="https://centrifugal.dev/docs/4/getting-started/migration_v4" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EPXZ1LXJ33-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title=" Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title=" JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZRQD92LEX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-NZRQD92LEX",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Centrifugo" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"><link rel="stylesheet" href="/assets/css/styles.4a639105.css">
<script src="/assets/js/runtime~main.e9013c36.js" defer="defer"></script>
<script src="/assets/js/main.df29f4cc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Centrifugo</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/4/getting-started/introduction">Getting Started</a><a class="navbar__item navbar__link" href="/docs/4/server/configuration">Server guide</a><a class="navbar__item navbar__link" href="/docs/4/transports/overview">Real-time transports / SDK</a><a class="navbar__item navbar__link" href="/docs/4/pro/overview">Centrifugo PRO ♻️</a><a class="navbar__item navbar__link" href="/docs/4/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/tutorial/intro">Grand tutorial</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/centrifugal/centrifugo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/4/getting-started/migration_v4">v4</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/migration_v4">v6</a></li><li><a class="dropdown__link" href="/docs/5/getting-started/migration_v4">v5</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/4/getting-started/migration_v4">v4</a></li><li><a class="dropdown__link" href="/docs/3/getting-started/introduction">v3</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>Centrifugo</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/introduction">Centrifugo introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/community">Join community</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/installation">Install Centrifugo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/quickstart">Quickstart tutorial</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/highlights">Main highlights</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/integration">Integration guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/design">Design overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4/getting-started/ecosystem">Ecosystem notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/4/getting-started/migration_v4">Migrating to v4</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Centrifugo<!-- --> <b>v4</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/getting-started/migration_v4">latest version</a></b> (<!-- -->v6<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Migrating to v4</h1></header><p>Centrifugo v4 development was concentrated around two main things:</p>
<ul>
<li>adopt a new generation of client protocol</li>
<li>make namespaces secure by default</li>
</ul>
<p>These goals dictate most of backwards compatibility changes in v4.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>What we would like to emphasize is that even there are many backwards incompatible changes it should be possible to migrate to Centrifugo v4 server without changing your client-side code at all. And then gradually upgrade the client-side. Below we are giving all the tips to achieve this.</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="client-sdk-migration">Client SDK migration<a href="#client-sdk-migration" class="hash-link" aria-label="Direct link to Client SDK migration" title="Direct link to Client SDK migration">​</a></h2>
<p>New generation of client protocol requires using the latest versions of client SDKs. During the next several days we will release the following SDK versions which are compatible with Centrifugo v4:</p>
<ul>
<li>centrifuge-js &gt;= v3.0.0</li>
<li>centrifuge-go &gt;= v0.9.0</li>
<li>centrifuge-dart &gt;= v0.9.0</li>
<li>centrifuge-swift &gt;= v0.5.0</li>
<li>centrifuge-java &gt;= v0.2.0</li>
</ul>
<p>New client SDKs <strong>support only new client protocol</strong> – you can not connect to Centrifugo v3 with them.</p>
<p>If you have a production system where you want to upgrade Centrifugo from v3 to v4 then the plan is:</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>If you are using private channels (starting with <code>$</code>) or user-limited channels (containing <code>#</code>) then carefully read about subscription token migration and user-limited channels migration below.</p></div></div>
<ol>
<li>Upgrade Centrifugo and its configuration to adopt changes in v4.</li>
<li>In Centrifugo v4 config turn on <code>use_client_protocol_v1_by_default</code>.</li>
<li>Run Centrifugo v4 – all current clients should continue working with it.</li>
<li>Then on the client-side uprade client SDK version to the one which works with Centrifugo v4, adopt changes in SDK API dictated by our new <a href="/docs/4/transports/client_api">client SDK API spec</a>. <strong>Important thing</strong> – add <code>?cf_protocol_version=v2</code> URL param to the connection endpoint to tell Centrifugo that modern generation of protocol is being used by the connection (otherwise, it assumes old protocol since we have <code>use_client_protocol_v1_by_default</code> option enabled).</li>
<li>As soon as all your clients migrated to use new protocol generation you can remove <code>use_client_protocol_v1_by_default</code> option from the server configuration.</li>
<li>After that you can remove <code>?cf_protocol_version=v2</code> from connection endpoint on the client-side.</li>
</ol>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>If you are using mobile client SDKs then most probably some time must pass while clients update their apps to use an updated Centrifugo SDK version.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Starting from Centrifugo v4.1.1 it&#x27;s possible to completely turn off client protocol v1 by setting <code>disable_client_protocol_v1</code> boolean option to <code>true</code>.</p></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="unidirectional-transport-migration">Unidirectional transport migration<a href="#unidirectional-transport-migration" class="hash-link" aria-label="Direct link to Unidirectional transport migration" title="Direct link to Unidirectional transport migration">​</a></h2>
<p>Client protocol framing also changed in unidirectional transports. The good news is that Centrifugo v4 still supports previous format for unidirectional transports.</p>
<p>When you are enabling <code>use_client_protocol_v1_by_default</code> option described above you also make unidirectional transports to work over old protocol format. So your existing clients will continue working just fine with Centrifugo v4. Then the same steps to migrate described above can be applied to unidirectional transport case. The only difference that in unidirectional approach you are not using Centrifugo SDKs.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="sockjs-migration">SockJS migration<a href="#sockjs-migration" class="hash-link" aria-label="Direct link to SockJS migration" title="Direct link to SockJS migration">​</a></h2>
<p>SockJS is now DEPRECATED in Centrifugo. Centrifugo v4 may be the last release which supports it. We now offer our own bidirectional emulation layer on top of HTTP-streaming and EventSource. See additional information in Centrifugo v4 introduction post.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="channel-ascii-enforced">Channel ASCII enforced<a href="#channel-ascii-enforced" class="hash-link" aria-label="Direct link to Channel ASCII enforced" title="Direct link to Channel ASCII enforced">​</a></h2>
<p>Centrifugo v2 and v3 docs mentioned the fact that channels must contain only ASCII characters. But it was not actually enforced by a server. Now Centrifugo is more strict. If a channel has non-ASCII characters then the <code>107: bad request</code> error will be returned to the client. Please reach us out if this behavior is not suitable for your use case – we can discuss the use case and think on a proper solution together.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="subscription-token-migration">Subscription token migration<a href="#subscription-token-migration" class="hash-link" aria-label="Direct link to Subscription token migration" title="Direct link to Subscription token migration">​</a></h2>
<p>Subscription token now requires <code>sub</code> claim (current user ID) to be set.</p>
<p>In most cases the only change which is required to smoothly migrate to v4 without breaking things is to add a boolean option <code>&quot;skip_user_check_in_subscription_token&quot;: true</code> to a Centrifugo v4 configuration. This skips the check of <code>sub</code> claim to contain the current user ID set to a connection during authentication.</p>
<p>After that start adding <code>sub</code> claim (with current user ID) to subscription tokens. As soon as all subscription tokens in your system contain user ID in <code>sub</code> claim you can remove the <code>skip_user_check_in_subscription_token</code> from a server configuration.</p>
<p>One more important note is that <code>client</code> claim in subscription token in Centrifugo v4 only supported for backwards compatibility. It must not be included into new subscription tokens.</p>
<p>It&#x27;s worth mentioning that Centrifugo v4 does not allow subscribing on channels starting with <code>$</code> without token even if namespace marked as available for subscribing using sth like <code>allow_subscribe_for_client</code> option. This is done to prevent potential security risk during v3 -&gt; v4 migration when client previously not available to subscribe to channels starting with <code>$</code> in any case may get permissions to do so.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="user-limited-channel-migration">User-limited channel migration<a href="#user-limited-channel-migration" class="hash-link" aria-label="Direct link to User-limited channel migration" title="Direct link to User-limited channel migration">​</a></h2>
<p>User-limited channel support should now be allowed over a separate channel namespace option <code>allow_user_limited_channels</code>. See below the namespace option converter which takes this change into account.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="namespace-configuration-migration">Namespace configuration migration<a href="#namespace-configuration-migration" class="hash-link" aria-label="Direct link to Namespace configuration migration" title="Direct link to Namespace configuration migration">​</a></h2>
<p>In Centrifugo v4 namespace configuration options have been changed. Centrifugo now has <code>secure by default</code> namespaces. First thing to do is to read the new docs about <a href="/docs/4/server/channels">channels and namespaces</a>.</p>
<p>Then you can use the following converter which will transform your old namespace configuration to a new one. This converter tries to keep backwards compatibility – i.e. it should be possible to deploy Centrifugo with namespace configuration from converter output and have the same behaviour as before regarding channel permissions. We believe that new option names should provide a more readable configuration and may help to reveal some potential security improvements in your namespace configuration – i.e. making it more strict and protective.</p>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>Do not blindly deploy things to production – test your system first, go through the possible usage scenarios and/or test cases.</p></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>It&#x27;s fully client-side: your data won&#x27;t be sent anywhere.</p></div></div>
<!-- -->
<div><textarea placeholder="Paste your Centrifugo v3 JSON config here..." style="width:100%;height:300px;border:2px solid #ccc"></textarea><button>Convert</button><pre style="margin-top:10px">Here will be configuration for v4</pre><pre style="margin-top:10px">Here will be log of changes made in your config</pre></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="proxy-disconnect-code-changes">Proxy disconnect code changes<a href="#proxy-disconnect-code-changes" class="hash-link" aria-label="Direct link to Proxy disconnect code changes" title="Direct link to Proxy disconnect code changes">​</a></h2>
<p><code>reconnect</code> flag from custom disconnect code is removed. Reconnect advice is now determined by disconnect code value. This allowed us avoiding using JSON in WebSocket CLOSE frame reason. See <a href="/docs/4/server/proxy#return-custom-disconnect">proxy docs</a> docs for more details.</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="other-configuration-option-changes">Other configuration option changes<a href="#other-configuration-option-changes" class="hash-link" aria-label="Direct link to Other configuration option changes" title="Direct link to Other configuration option changes">​</a></h2>
<p>Several other non-namespace related options have been renamed or removed:</p>
<ul>
<li><code>client_anonymous</code> option renamed to <code>allow_anonymous_connect_without_token</code> – new name better describes the purpose of this option which was previously not clear. Converter above takes this into account.</li>
<li><code>use_unlimited_history_by_default</code> option was removed. It was used to help migrating from Centrifugo v2 to v3.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="server-api-changes">Server API changes<a href="#server-api-changes" class="hash-link" aria-label="Direct link to Server API changes" title="Direct link to Server API changes">​</a></h2>
<p>The only breaking change is that <code>user_connections</code> API method (which is available in Centrifugo PRO only) was renamed to <code>connections</code>. The method is more generic now with a broader possibilities – so previous name does not match the current behavior.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/centrifugal/centrifugal.dev/edit/main/versioned_docs/version-4/getting-started/migration-v4.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/4/getting-started/ecosystem"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Ecosystem notes</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#client-sdk-migration" class="table-of-contents__link toc-highlight">Client SDK migration</a></li><li><a href="#unidirectional-transport-migration" class="table-of-contents__link toc-highlight">Unidirectional transport migration</a></li><li><a href="#sockjs-migration" class="table-of-contents__link toc-highlight">SockJS migration</a></li><li><a href="#channel-ascii-enforced" class="table-of-contents__link toc-highlight">Channel ASCII enforced</a></li><li><a href="#subscription-token-migration" class="table-of-contents__link toc-highlight">Subscription token migration</a></li><li><a href="#user-limited-channel-migration" class="table-of-contents__link toc-highlight">User-limited channel migration</a></li><li><a href="#namespace-configuration-migration" class="table-of-contents__link toc-highlight">Namespace configuration migration</a></li><li><a href="#proxy-disconnect-code-changes" class="table-of-contents__link toc-highlight">Proxy disconnect code changes</a></li><li><a href="#other-configuration-option-changes" class="table-of-contents__link toc-highlight">Other configuration option changes</a></li><li><a href="#server-api-changes" class="table-of-contents__link toc-highlight">Server API changes</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contact us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hello@centrifugal.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Send e-mail</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/joinchat/U57MI8Lam9mhpuhd" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/tYgADKx" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/centrifugalabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/attributions">Attributions</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Centrifugal Labs LTD</div></div></div></footer></div>
</body>
</html>