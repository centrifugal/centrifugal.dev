<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-server/engines" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.3.2">
<title data-rh="true">Engines and scalability | Centrifugo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://centrifugal.dev/img/centrifugo_soc.png"><meta data-rh="true" name="twitter:image" content="https://centrifugal.dev/img/centrifugo_soc.png"><meta data-rh="true" property="og:url" content="https://centrifugal.dev/docs/server/engines"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Engines and scalability | Centrifugo"><meta data-rh="true" name="description" content="The Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve online presence and history data."><meta data-rh="true" property="og:description" content="The Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve online presence and history data."><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://centrifugal.dev/docs/server/engines"><link data-rh="true" rel="alternate" href="https://centrifugal.dev/docs/server/engines" hreflang="en"><link data-rh="true" rel="alternate" href="https://centrifugal.dev/docs/server/engines" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EPXZ1LXJ33-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title=" Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title=" JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZRQD92LEX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-NZRQD92LEX",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Centrifugo" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"><link rel="stylesheet" href="/assets/css/styles.b981224e.css">
<script src="/assets/js/runtime~main.649cce4b.js" defer="defer"></script>
<script src="/assets/js/main.439c6ff0.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Centrifugo</b></a><a class="navbar__item navbar__link" href="/docs/getting-started/introduction">Getting Started</a><a class="navbar__item navbar__link" href="/docs/tutorial/intro">Grand tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/server/configuration">Server guide</a><a class="navbar__item navbar__link" href="/docs/transports/overview">Real-time transports / SDK</a><a class="navbar__item navbar__link" href="/docs/pro/overview">Centrifugo PRO ♻️</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/centrifugal/centrifugo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/getting-started/introduction">v5</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/server/engines">v5</a></li><li><a class="dropdown__link" href="/docs/4/server/engines">v4</a></li><li><a class="dropdown__link" href="/docs/3/server/engines">v3</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"><b>Centrifugo</b></a><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/configuration">Configure Centrifugo</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/server_api">Server API walkthrough</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/authentication">Client JWT authentication</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/channels">Channels and namespaces</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/channel_permissions">Channel permission model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/channel_token_auth">Channel JWT authorization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/server_subs">Server-side subscriptions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/server/engines">Engines and scalability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/consumers">Async consumers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/history_and_recovery">History and recovery</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/cache_recovery">Cache recovery mode</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/delta_compression">Delta compression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/presence">Online presence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/proxy">Proxy events to the backend</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/proxy_streams">Proxy subscription streams</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/admin_web">Admin web UI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/observability">Server observability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/infra_tuning">Infrastructure tuning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/load_balancing">Load balancing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/tls">Configure TLS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/codes">Client protocol codes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/server/console_commands">Helper CLI commands</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Engines and scalability</h1></header><p>The Engine in Centrifugo is responsible for publishing messages between nodes, handle PUB/SUB broker subscriptions, save/retrieve online presence and history data.</p>
<p>By default, Centrifugo uses a Memory engine. There are also Redis and Tarantool engines available. And Nats broker which also supports at most once PUB/SUB. Centrifugo also works with Redis-compatible storages such as AWS Elasticache, KeyDB, DragonflyDB.</p>
<p>With default Memory engine you can start only one node of Centrifugo, while other engines allow running several nodes on different machines to scale client connections and for Centrifugo node high availability. In distributed case all Centrifugo nodes will be connected via broker PUB/SUB, will discover each other and deliver publications to the node where active channel subscribers exist.</p>
<p>Memory engine keeps history and presence data in process memory, so the data is lost upon server restart. When using Redis Engine the data is kept in Redis (where you can configure desired persistence properties) instead of Centrifugo node process memory, so channel history data won&#x27;t be lost after Centrifugo server restart.</p>
<p>To set engine you can use <code>engine</code> configuration option. Available values are <code>memory</code>, <code>redis</code>, <code>tarantool</code>. The default value is <code>memory</code>.</p>
<p>For example to work with Redis engine:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="memory-engine">Memory engine<a href="#memory-engine" class="hash-link" aria-label="Direct link to Memory engine" title="Direct link to Memory engine">​</a></h2>
<p>Used by default. Supports only one node. Nice choice to start with. Supports all features keeping everything in Centrifugo node process memory. You don&#x27;t need to install Redis when using this engine.</p>
<p>Advantages:</p>
<ul>
<li>Super fast since it does not involve network at all</li>
<li>Does not require separate broker setup</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Does not allow scaling nodes (actually you still can scale Centrifugo with Memory engine but you have to publish data into each Centrifugo node and you won&#x27;t have consistent history and presence state throughout Centrifugo nodes)</li>
<li>Does not persist message history in channels between Centrifugo restarts.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-engine">Redis engine<a href="#redis-engine" class="hash-link" aria-label="Direct link to Redis engine" title="Direct link to Redis engine">​</a></h2>
<p><a href="https://redis.io/" target="_blank" rel="noopener noreferrer">Redis</a> is an open-source, in-memory data structure store, used as a database, cache, and message broker.</p>
<p>Centrifugo Redis engine allows scaling Centrifugo nodes to different machines. Nodes will use Redis as a message broker (utilizing Redis PUB/SUB for node communication) and keep presence and history data in Redis.</p>
<p><strong>Minimal Redis version is 5.0.1</strong></p>
<p>With Redis it&#x27;s possible to come to the architecture like this:</p>
<p><img decoding="async" loading="lazy" alt="redis" src="/assets/images/redis_arch-2eed8366b3d81263ea9ec2201512f964.png" width="2535" height="1306" class="img_ev3q"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-engine-options">Redis engine options<a href="#redis-engine-options" class="hash-link" aria-label="Direct link to Redis engine options" title="Direct link to Redis engine options">​</a></h3>
<p>Several configuration options related to Redis engine.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_address">redis_address<a href="#redis_address" class="hash-link" aria-label="Direct link to redis_address" title="Direct link to redis_address">​</a></h4>
<p>String, default <code>&quot;127.0.0.1:6379&quot;</code> - Redis server address.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_password">redis_password<a href="#redis_password" class="hash-link" aria-label="Direct link to redis_password" title="Direct link to redis_password">​</a></h4>
<p>String, default <code>&quot;&quot;</code> - Redis password.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_user">redis_user<a href="#redis_user" class="hash-link" aria-label="Direct link to redis_user" title="Direct link to redis_user">​</a></h4>
<p>String, default <code>&quot;&quot;</code> - Redis user for <a href="https://redis.io/docs/manual/security/acl/" target="_blank" rel="noopener noreferrer">ACL-based</a> auth.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_db">redis_db<a href="#redis_db" class="hash-link" aria-label="Direct link to redis_db" title="Direct link to redis_db">​</a></h4>
<p>Integer, default <code>0</code> - number of Redis db to use.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_prefix">redis_prefix<a href="#redis_prefix" class="hash-link" aria-label="Direct link to redis_prefix" title="Direct link to redis_prefix">​</a></h4>
<p>String, default <code>&quot;centrifugo&quot;</code> – custom prefix to use for channels and keys in Redis.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_use_lists">redis_use_lists<a href="#redis_use_lists" class="hash-link" aria-label="Direct link to redis_use_lists" title="Direct link to redis_use_lists">​</a></h4>
<p>Boolean, default <code>false</code> – turns on using Redis Lists instead of Stream data structure for keeping history (not recommended, keeping this for backwards compatibility mostly).</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_force_resp2">redis_force_resp2<a href="#redis_force_resp2" class="hash-link" aria-label="Direct link to redis_force_resp2" title="Direct link to redis_force_resp2">​</a></h4>
<p>Boolean, default <code>false</code>. If set to true it forces using RESP2 protocol for communicating with Redis. By default, Redis client used by Centrifugo tries to detect supported Redis protocol automatically trying RESP3 first.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="configuring-redis-tls">Configuring Redis TLS<a href="#configuring-redis-tls" class="hash-link" aria-label="Direct link to Configuring Redis TLS" title="Direct link to Configuring Redis TLS">​</a></h3>
<p>Some options may help you configuring TLS-protected communication between Centrifugo and Redis.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_tls">redis_tls<a href="#redis_tls" class="hash-link" aria-label="Direct link to redis_tls" title="Direct link to redis_tls">​</a></h4>
<p>Boolean, default <code>false</code> - enable Redis TLS connection.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_tls_insecure_skip_verify">redis_tls_insecure_skip_verify<a href="#redis_tls_insecure_skip_verify" class="hash-link" aria-label="Direct link to redis_tls_insecure_skip_verify" title="Direct link to redis_tls_insecure_skip_verify">​</a></h4>
<p>Boolean, default <code>false</code> - disable Redis TLS host verification. Centrifugo v4 also supports alias for this option – <code>redis_tls_skip_verify</code> – but it will be removed in v5.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_tls_cert">redis_tls_cert<a href="#redis_tls_cert" class="hash-link" aria-label="Direct link to redis_tls_cert" title="Direct link to redis_tls_cert">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – path to TLS cert file. If you prefer passing certificate as a string instead of path to the file then use <code>redis_tls_cert_pem</code> option.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_tls_key">redis_tls_key<a href="#redis_tls_key" class="hash-link" aria-label="Direct link to redis_tls_key" title="Direct link to redis_tls_key">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – path to TLS key file.  If you prefer passing cert key as a string instead of path to the file then use <code>redis_tls_key_pem</code> option.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_tls_root_ca">redis_tls_root_ca<a href="#redis_tls_root_ca" class="hash-link" aria-label="Direct link to redis_tls_root_ca" title="Direct link to redis_tls_root_ca">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – path to TLS root CA file (in PEM format) to use. If you prefer passing root CA PEM as a string instead of path to the file then use <code>redis_tls_root_ca_pem</code> option.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_tls_server_name">redis_tls_server_name<a href="#redis_tls_server_name" class="hash-link" aria-label="Direct link to redis_tls_server_name" title="Direct link to redis_tls_server_name">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – used to verify the hostname on the returned certificates. It is also included in the client&#x27;s handshake to support virtual hosting unless it is an IP address.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="scaling-with-redis-tutorial">Scaling with Redis tutorial<a href="#scaling-with-redis-tutorial" class="hash-link" aria-label="Direct link to Scaling with Redis tutorial" title="Direct link to Scaling with Redis tutorial">​</a></h3>
<p>Let&#x27;s see how to start several Centrifugo nodes using the Redis Engine. We will start 3 Centrifugo nodes and all those nodes will be connected via Redis.</p>
<p>First, you should have Redis running. As soon as it&#x27;s running - we can launch 3 Centrifugo instances. Open your terminal and start the first one:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --port=8000 --engine=redis --redis_address=127.0.0.1:6379</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If your Redis is on the same machine and runs on its default port you can omit <code>redis_address</code> option in the command above.</p>
<p>Then open another terminal and start another Centrifugo instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --port=8001 --engine=redis --redis_address=127.0.0.1:6379</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Note that we use another port number (<code>8001</code>) as port 8000 is already busy by our first Centrifugo instance. If you are starting Centrifugo instances on different machines then you most probably can use
the same port number (<code>8000</code> or whatever you want) for all instances.</p>
<p>And finally, let&#x27;s start the third instance:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --port=8002 --engine=redis --redis_address=127.0.0.1:6379</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you have 3 Centrifugo instances running on ports 8000, 8001, 8002 and clients can connect to any of them. You can also send API requests to any of those nodes – as all nodes connected over Redis PUB/SUB message will be delivered to all interested clients on all nodes.</p>
<p>To load balance clients between nodes you can use Nginx – you can find its configuration here in the documentation.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>In the production environment you will most probably run Centrifugo nodes on different hosts, so there will be no need to use different <code>port</code> numbers.</p></div></div>
<p>Here is a live example where we locally start two Centrifugo nodes both connected to local Redis:</p>
<video width="100%" controls=""><source src="/img/redis_scale_example.mp4" type="video/mp4"><p>Sorry, your browser doesn&#x27;t support embedded video.</p></video>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-sentinel-for-high-availability">Redis Sentinel for high availability<a href="#redis-sentinel-for-high-availability" class="hash-link" aria-label="Direct link to Redis Sentinel for high availability" title="Direct link to Redis Sentinel for high availability">​</a></h3>
<p>Centrifugo supports the official way to add high availability to Redis - Redis <a href="http://redis.io/topics/sentinel" target="_blank" rel="noopener noreferrer">Sentinel</a>.</p>
<p>For this you only need to utilize 2 Redis Engine options: <code>redis_sentinel_address</code> and <code>redis_sentinel_master_name</code>:</p>
<ul>
<li><code>redis_sentinel_address</code> (string, default <code>&quot;&quot;</code>) - comma separated list of Sentinel addresses for HA. At least one known server required.</li>
<li><code>redis_sentinel_master_name</code> (string, default <code>&quot;&quot;</code>) - name of Redis master Sentinel monitors</li>
</ul>
<p>Also:</p>
<ul>
<li><code>redis_sentinel_password</code> – optional string password for your Sentinel, works with Redis Sentinel &gt;= 5.0.1</li>
<li><code>redis_sentinel_user</code> - optional string user (used only in Redis ACL-based auth).</li>
</ul>
<p>So you can start Centrifugo which will use Sentinels to discover Redis master instances like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Where config.json:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_sentinel_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:26379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_sentinel_master_name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;mymaster&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sentinel configuration file may look like this (for 3-node Sentinel setup with quorum 2):</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">port 26379</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentinel monitor mymaster 127.0.0.1 6379 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentinel down-after-milliseconds mymaster 10000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sentinel failover-timeout mymaster 60000</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can find how to properly set up Sentinels <a href="http://redis.io/topics/sentinel" target="_blank" rel="noopener noreferrer">in official documentation</a>.</p>
<p>Note that when your Redis master instance is down there will be a small downtime interval until Sentinels
discover a problem and come to a quorum decision about a new master. The length of this period depends on
Sentinel configuration.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-sentinel-tls">Redis Sentinel TLS<a href="#redis-sentinel-tls" class="hash-link" aria-label="Direct link to Redis Sentinel TLS" title="Direct link to Redis Sentinel TLS">​</a></h3>
<p>To configure TLS for Redis Sentinel use the following options.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_sentinel_tls">redis_sentinel_tls<a href="#redis_sentinel_tls" class="hash-link" aria-label="Direct link to redis_sentinel_tls" title="Direct link to redis_sentinel_tls">​</a></h4>
<p>Boolean, default <code>false</code> - enable Redis TLS connection.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_sentinel_tls_insecure_skip_verify">redis_sentinel_tls_insecure_skip_verify<a href="#redis_sentinel_tls_insecure_skip_verify" class="hash-link" aria-label="Direct link to redis_sentinel_tls_insecure_skip_verify" title="Direct link to redis_sentinel_tls_insecure_skip_verify">​</a></h4>
<p>Boolean, default <code>false</code> - disable Redis TLS host verification. Centrifugo v4 also supports alias for this option – <code>redis_sentinel_tls_skip_verify</code> – but it will be removed in v5.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_sentinel_tls_cert">redis_sentinel_tls_cert<a href="#redis_sentinel_tls_cert" class="hash-link" aria-label="Direct link to redis_sentinel_tls_cert" title="Direct link to redis_sentinel_tls_cert">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – path to TLS cert file. If you prefer passing certificate as a string instead of path to the file then use <code>redis_sentinel_tls_cert_pem</code> option.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_sentinel_tls_key">redis_sentinel_tls_key<a href="#redis_sentinel_tls_key" class="hash-link" aria-label="Direct link to redis_sentinel_tls_key" title="Direct link to redis_sentinel_tls_key">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – path to TLS key file.  If you prefer passing cert key as a string instead of path to the file then use <code>redis_sentinel_tls_key_pem</code> option.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_sentinel_tls_root_ca">redis_sentinel_tls_root_ca<a href="#redis_sentinel_tls_root_ca" class="hash-link" aria-label="Direct link to redis_sentinel_tls_root_ca" title="Direct link to redis_sentinel_tls_root_ca">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – path to TLS root CA file (in PEM format) to use. If you prefer passing root CA PEM as a string instead of path to the file then use <code>redis_sentinel_tls_root_ca_pem</code> option.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis_sentinel_tls_server_name">redis_sentinel_tls_server_name<a href="#redis_sentinel_tls_server_name" class="hash-link" aria-label="Direct link to redis_sentinel_tls_server_name" title="Direct link to redis_sentinel_tls_server_name">​</a></h4>
<p>String, default <code>&quot;&quot;</code> – used to verify the hostname on the returned certificates. It is also included in the client&#x27;s handshake to support virtual hosting unless it is an IP address.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="haproxy-instead-of-sentinel-configuration">Haproxy instead of Sentinel configuration<a href="#haproxy-instead-of-sentinel-configuration" class="hash-link" aria-label="Direct link to Haproxy instead of Sentinel configuration" title="Direct link to Haproxy instead of Sentinel configuration">​</a></h3>
<p>Alternatively, you can use Haproxy between Centrifugo and Redis to let it properly balance traffic to Redis master. In this case, you still need to configure Sentinels but you can omit Sentinel specifics from Centrifugo configuration and just use Redis address as in a simple non-HA case.</p>
<p>For example, you can use something like this in Haproxy config:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">listen redis</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    server redis-01 127.0.0.1:6380 check port 6380 check inter 2s weight 1 inter 2s downinter 5s rise 10 fall 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    server redis-02 127.0.0.1:6381 check port 6381 check inter 2s weight 1 inter 2s downinter 5s rise 10 fall 2 backup</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bind *:16379</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    mode tcp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    option tcpka</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    option tcplog</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    option tcp-check</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check send PING\r\n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check expect string +PONG</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check send info\ replication\r\n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check expect string role:master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check send QUIT\r\n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tcp-check expect string +OK</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    balance roundrobin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And then just point Centrifugo to this Haproxy:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --config=config.json --engine=redis --redis_address=&quot;localhost:16379&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-sharding">Redis sharding<a href="#redis-sharding" class="hash-link" aria-label="Direct link to Redis sharding" title="Direct link to Redis sharding">​</a></h3>
<p>Centrifugo has built-in Redis sharding support.</p>
<p>This resolves the situation when Redis becoming a bottleneck on a large Centrifugo setup. Redis is a single-threaded server, it&#x27;s very fast but its power is not infinite so when your Redis approaches 100% CPU usage then the sharding feature can help your application to scale.</p>
<p>At moment Centrifugo supports a simple comma-based approach to configuring Redis shards. Let&#x27;s just look at examples.</p>
<p>To start Centrifugo with 2 Redis shards on localhost running on port 6379 and port 6380 use config like this:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:6380&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>To start Centrifugo with Redis instances on different hosts:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;redis&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;192.168.1.34:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;192.168.1.35:6379&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you also need to customize AUTH password, Redis DB number then you can use an extended address notation.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Due to how Redis PUB/SUB works it&#x27;s not possible (and it&#x27;s pretty useless anyway) to run shards in one Redis instance using different Redis DB numbers.</p></div></div>
<p>When sharding enabled Centrifugo will spread channels and history/presence keys over configured Redis instances using a consistent hashing algorithm. At moment we use Jump consistent hash algorithm (see <a href="https://arxiv.org/pdf/1406.2294.pdf" target="_blank" rel="noopener noreferrer">paper</a> and <a href="https://github.com/dgryski/go-jump" target="_blank" rel="noopener noreferrer">implementation</a>).</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-cluster">Redis cluster<a href="#redis-cluster" class="hash-link" aria-label="Direct link to Redis cluster" title="Direct link to Redis cluster">​</a></h3>
<p>Running Centrifugo with Redis cluster is simple and can be achieved using <code>redis_cluster_address</code> option. This is an array of strings. Each element of the array is a comma-separated Redis cluster seed node. For example:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_cluster_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30001,localhost:30002,localhost:30003&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You don&#x27;t need to list all Redis cluster nodes in config – only several working nodes are enough to start.</p>
<p>To set the same over environment variable:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CENTRIFUGO_REDIS_CLUSTER_ADDRESS=&quot;localhost:30001&quot; CENTRIFUGO_ENGINE=redis ./centrifugo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you need to shard data between several Redis clusters then simply add one more string with seed nodes of another cluster to this array:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;redis_cluster_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30001,localhost:30002,localhost:30003&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost:30101,localhost:30102,localhost:30103&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Sharding between different Redis clusters can make sense due to the fact how PUB/SUB works in the Redis cluster. It does not scale linearly when adding nodes as all PUB/SUB messages got copied to every cluster node. See <a href="https://github.com/antirez/redis/issues/2672" target="_blank" rel="noopener noreferrer">this discussion</a> for more information on topic. To spread data between different Redis clusters Centrifugo uses the same consistent hashing algorithm described above (i.e. <code>Jump</code>).</p>
<p>To reproduce the same over environment variable use <code>space</code> to separate different clusters:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CENTRIFUGO_REDIS_CLUSTER_ADDRESS=&quot;localhost:30001,localhost:30002 localhost:30101,localhost:30102&quot; CENTRIFUGO_ENGINE=redis ./centrifugo</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="optimize-getting-presence-stats">Optimize getting presence stats<a href="#optimize-getting-presence-stats" class="hash-link" aria-label="Direct link to Optimize getting presence stats" title="Direct link to Optimize getting presence stats">​</a></h3>
<p>Starting from Centrifugo v5.2.1 it&#x27;s possible to keep user mapping information on Redis side to optimize <a href="/docs/server/server_api#presence_stats">presence stats</a> API.</p>
<p>It&#x27;s implemented in a way that Centrifugo maintains additional per-user data structures in Redis. Similar to structures used for general client presence (ZSET + HASH). So we get a possibility to efficiently get both the number of clients in channel and the number of unique users in it.</p>
<p>This may be useful to drastically reduce the time of Redis operation if you call presence stats for channels with large number of active subscribers. In our benchmarks, for a channel with 100k unique subscribers, number of presence stats ops bumped from 15 to 200k per second.</p>
<p>The feature comes with a cost – it increases memory usage in Redis, possibly up to 2x from what was spent on presence information before enabling (less if you use <code>info</code> attached to a client connection, since Centrifugo does not include info payload to user mapping structures).</p>
<p>To enable set <code>global_redis_presence_user_mapping</code> boolean option to <code>true</code>:</p>
<div class="language-javascript codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-javascript codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token spread operator" style="color:rgb(137, 221, 255)">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token string-property property">&quot;global_redis_presence_user_mapping&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="other-redis-compatible">Other Redis compatible<a href="#other-redis-compatible" class="hash-link" aria-label="Direct link to Other Redis compatible" title="Direct link to Other Redis compatible">​</a></h2>
<p>When using Redis engine it&#x27;s possible to point Centrifugo not only to Redis itself, but also to the other Redis compatible server. Such servers may work just fine if implement Redis protocol and support all the data structures Centrifugo uses and have PUB/SUB implemented.</p>
<p>Some known options:</p>
<ul>
<li><a href="https://aws.amazon.com/elasticache/" target="_blank" rel="noopener noreferrer">AWS Elasticache</a> – it was reported to work, but we suggest you testing the setup including failover tests and work under load.</li>
<li><a href="https://keydb.dev/" target="_blank" rel="noopener noreferrer">KeyDB</a> – should work fine with Centrifugo, no known problems at this point regarding Centrifugo compatibility.</li>
<li><a href="https://dragonflydb.io/" target="_blank" rel="noopener noreferrer">DragonflyDB</a> - should work fine (if you experience issues with it try enabling <code>redis_force_resp2</code> option). We have not tested a Redis Cluster emulation mode provided by DragonflyDB yet. We suggest you testing the setup including failover tests and work under load.</li>
<li><a href="https://github.com/valkey-io/valkey" target="_blank" rel="noopener noreferrer">Valkey</a> – should work fine since it&#x27;s based on Redis v7, but no tests were performed by Centrifugal Labs.</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool-engine">Tarantool engine<a href="#tarantool-engine" class="hash-link" aria-label="Direct link to Tarantool engine" title="Direct link to Tarantool engine">​</a></h2>
<p><strong>DEPRECATED</strong></p>
<p><a href="https://www.tarantool.io" target="_blank" rel="noopener noreferrer">Tarantool</a> is a fast and flexible in-memory storage with different persistence/replication schemes and LuaJIT for writing custom logic on the Tarantool side. It allows implementing Centrifugo engine with unique characteristics.</p>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Tarantool engine is DEPRECATED and will be removed in Centrifugo v6. See <a href="https://github.com/centrifugal/centrifugo/issues/830" target="_blank" rel="noopener noreferrer">the issue on Github</a>.</p></div></div>
<p>There are many ways to operate Tarantool in production and it&#x27;s hard to distribute Centrifugo Tarantool engine in a way that suits everyone. Centrifugo tries to fit generic case by providing <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a> module and by providing ready-to-use <a href="https://github.com/centrifugal/rotor" target="_blank" rel="noopener noreferrer">centrifugal/rotor</a> project based on <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a> and <a href="https://github.com/tarantool/cartridge" target="_blank" rel="noopener noreferrer">Tarantool Cartridge</a>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>To be honest we bet on the community help to push this integration further. Tarantool provides an incredible performance boost for presence and history operations (up to 5x more RPS compared to the Redis Engine) and a pretty fast PUB/SUB (comparable to what Redis Engine provides). Let&#x27;s see what we can build together.</p></div></div>
<p>There are several supported Tarantool topologies to which Centrifugo can connect:</p>
<ul>
<li>One standalone Tarantool instance</li>
<li>Many standalone Tarantool instances and consistently shard data between them</li>
<li>Tarantool running in Cartridge</li>
<li>Tarantool with replica and automatic failover in Cartridge</li>
<li>Many Tarantool instances (or leader-follower setup) in Cartridge with consistent client-side sharding between them</li>
<li>Tarantool with synchronous replication (Raft-based, Tarantool &gt;= 2.7)</li>
</ul>
<p>After running Tarantool you can point Centrifugo to it (and of course scale Centrifugo nodes):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">config.json</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;engine&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;tarantool&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;tarantool_address&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;127.0.0.1:3301&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="https://github.com/centrifugal/rotor" target="_blank" rel="noopener noreferrer">centrifugal/rotor</a> repo for ready-to-use engine based on Tarantool Cartridge framework.</p>
<p>See <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a> repo for examples on how to run engine with Standalone single Tarantool instance or with Raft-based synchronous replication.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool-engine-options">Tarantool engine options<a href="#tarantool-engine-options" class="hash-link" aria-label="Direct link to Tarantool engine options" title="Direct link to Tarantool engine options">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool_address">tarantool_address<a href="#tarantool_address" class="hash-link" aria-label="Direct link to tarantool_address" title="Direct link to tarantool_address">​</a></h4>
<p>String or array of strings. Default <code>tcp://127.0.0.1:3301</code>.</p>
<p>Connection address to Tarantool.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool_mode">tarantool_mode<a href="#tarantool_mode" class="hash-link" aria-label="Direct link to tarantool_mode" title="Direct link to tarantool_mode">​</a></h4>
<p>String, default <code>standalone</code></p>
<p>A mode how to connect to Tarantool. Default is <code>standalone</code> which connects to a single Tarantool instance address. Possible values are: <code>leader-follower</code> (connects to a setup with Tarantool master and async replicas) and <code>leader-follower-raft</code> (connects to a Tarantool with synchronous Raft-based replication).</p>
<p>All modes support client-side consistent sharding (similar to what Redis engine provides).</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool_user">tarantool_user<a href="#tarantool_user" class="hash-link" aria-label="Direct link to tarantool_user" title="Direct link to tarantool_user">​</a></h4>
<p>String, default <code>&quot;&quot;</code>. Allows setting a user.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool_password">tarantool_password<a href="#tarantool_password" class="hash-link" aria-label="Direct link to tarantool_password" title="Direct link to tarantool_password">​</a></h4>
<p>String, default <code>&quot;&quot;</code>. Allows setting a password.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool-engine-limitations">Tarantool engine limitations<a href="#tarantool-engine-limitations" class="hash-link" aria-label="Direct link to Tarantool engine limitations" title="Direct link to Tarantool engine limitations">​</a></h3>
<ul>
<li>idempotent publish is not implemented</li>
<li>delta compression for connections with positioning/recovery on is not implemented</li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nats-broker">Nats broker<a href="#nats-broker" class="hash-link" aria-label="Direct link to Nats broker" title="Direct link to Nats broker">​</a></h2>
<p>It&#x27;s possible to scale with <a href="https://nats.io/" target="_blank" rel="noopener noreferrer">Nats</a> PUB/SUB server. Keep in mind, that Nats is called a <strong>broker</strong> here, <strong>not an Engine</strong> – Nats integration only implements PUB/SUB part of Engine, so carefully read limitations below.</p>
<p>Limitations:</p>
<ul>
<li>Nats integration works only for unreliable at most once PUB/SUB. This means that history, presence, and message recovery Centrifugo features won&#x27;t be available.</li>
<li>Nats wildcard channel subscriptions with symbols <code>*</code> and <code>&gt;</code> not supported.</li>
</ul>
<p>First start Nats server:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ nats-server</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.324269 [INF] Starting nats-server version 2.1.7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.324400 [INF] Git commit [not set]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.325600 [INF] Listening for client connections on 0.0.0.0:4222</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.325612 [INF] Server id is NDAM7GEHUXAKS5SGMA3QE6ZSO4IQUJP6EL3G2E2LJYREVMAMIOBE7JT4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">[3569] 2020/07/08 20:28:44.325617 [INF] Server is ready</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then start Centrifugo with <code>broker</code> option:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --broker=nats --config=config.json</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And one more Centrifugo on another port (of course in real life you will start another Centrifugo on another machine):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">centrifugo --broker=nats --config=config.json --port=8001</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now you can scale connections over Centrifugo instances, instances will be connected over Nats server.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="options">Options<a href="#options" class="hash-link" aria-label="Direct link to Options" title="Direct link to Options">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nats_url">nats_url<a href="#nats_url" class="hash-link" aria-label="Direct link to nats_url" title="Direct link to nats_url">​</a></h4>
<p>String, default <code>nats://127.0.0.1:4222</code>.</p>
<p>Connection url in format <code>nats://derek:pass@localhost:4222</code>.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nats_prefix">nats_prefix<a href="#nats_prefix" class="hash-link" aria-label="Direct link to nats_prefix" title="Direct link to nats_prefix">​</a></h4>
<p>String, default <code>centrifugo</code>.</p>
<p>Prefix for channels used by Centrifugo inside Nats.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nats_dial_timeout">nats_dial_timeout<a href="#nats_dial_timeout" class="hash-link" aria-label="Direct link to nats_dial_timeout" title="Direct link to nats_dial_timeout">​</a></h4>
<p>Duration, default <code>1s</code>.</p>
<p>Timeout for dialing with Nats.</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="nats_write_timeout">nats_write_timeout<a href="#nats_write_timeout" class="hash-link" aria-label="Direct link to nats_write_timeout" title="Direct link to nats_write_timeout">​</a></h4>
<p>Duration, default <code>1s</code>.</p>
<p>Write (and flush) timeout for a connection to Nats.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/centrifugal/centrifugal.dev/edit/main/docs/server/engines.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/server/server_subs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Server-side subscriptions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/server/consumers"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Async consumers</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#memory-engine" class="table-of-contents__link toc-highlight">Memory engine</a></li><li><a href="#redis-engine" class="table-of-contents__link toc-highlight">Redis engine</a><ul><li><a href="#redis-engine-options" class="table-of-contents__link toc-highlight">Redis engine options</a></li><li><a href="#configuring-redis-tls" class="table-of-contents__link toc-highlight">Configuring Redis TLS</a></li><li><a href="#scaling-with-redis-tutorial" class="table-of-contents__link toc-highlight">Scaling with Redis tutorial</a></li><li><a href="#redis-sentinel-for-high-availability" class="table-of-contents__link toc-highlight">Redis Sentinel for high availability</a></li><li><a href="#redis-sentinel-tls" class="table-of-contents__link toc-highlight">Redis Sentinel TLS</a></li><li><a href="#haproxy-instead-of-sentinel-configuration" class="table-of-contents__link toc-highlight">Haproxy instead of Sentinel configuration</a></li><li><a href="#redis-sharding" class="table-of-contents__link toc-highlight">Redis sharding</a></li><li><a href="#redis-cluster" class="table-of-contents__link toc-highlight">Redis cluster</a></li><li><a href="#optimize-getting-presence-stats" class="table-of-contents__link toc-highlight">Optimize getting presence stats</a></li></ul></li><li><a href="#other-redis-compatible" class="table-of-contents__link toc-highlight">Other Redis compatible</a></li><li><a href="#tarantool-engine" class="table-of-contents__link toc-highlight">Tarantool engine</a><ul><li><a href="#tarantool-engine-options" class="table-of-contents__link toc-highlight">Tarantool engine options</a></li><li><a href="#tarantool-engine-limitations" class="table-of-contents__link toc-highlight">Tarantool engine limitations</a></li></ul></li><li><a href="#nats-broker" class="table-of-contents__link toc-highlight">Nats broker</a><ul><li><a href="#options" class="table-of-contents__link toc-highlight">Options</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contact us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hello@centrifugal.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Send e-mail</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/joinchat/U57MI8Lam9mhpuhd" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/tYgADKx" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/centrifugalabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/attributions">Attributions</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Centrifugal Labs LTD</div></div></div></footer></div>
</body>
</html>