<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Centrifugo v3 released | Centrifugo</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Centrifugo v3 released | Centrifugo"><meta data-rh="true" name="description" content="Centrifugo v3 released with lots of exciting improvements"><meta data-rh="true" property="og:description" content="Centrifugo v3 released with lots of exciting improvements"><meta data-rh="true" property="og:image" content="https://centrifugal.dev/img/v3_blog.jpg"><meta data-rh="true" name="twitter:image" content="https://centrifugal.dev/img/v3_blog.jpg"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-08-31T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="centrifugo,release"><link data-rh="true" rel="icon" href="/img/favicon.png"><link data-rh="true" rel="canonical" href="https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3"><link data-rh="true" rel="alternate" href="https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3" hreflang="en"><link data-rh="true" rel="alternate" href="https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://EPXZ1LXJ33-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","@id":"https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3","mainEntityOfPage":"https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3","url":"https://centrifugal.dev/blog/2021/08/31/hello-centrifugo-v3","headline":"Centrifugo v3 released","name":"Centrifugo v3 released","description":"Centrifugo v3 released with lots of exciting improvements","datePublished":"2021-08-31T00:00:00.000Z","author":{"@type":"Person","name":"Centrifugal team","description":"Let the Centrifugal force be with you","image":"/img/logo_animated.svg"},"image":{"@type":"ImageObject","@id":"https://centrifugal.dev/img/v3_blog.jpg","url":"https://centrifugal.dev/img/v3_blog.jpg","contentUrl":"https://centrifugal.dev/img/v3_blog.jpg","caption":"title image for the blog post: Centrifugo v3 released"},"keywords":[],"isPartOf":{"@type":"Blog","@id":"https://centrifugal.dev/blog","name":"Centrifugal Blog"}}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title=" Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title=" JSON Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-NZRQD92LEX"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-NZRQD92LEX",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Centrifugo" href="/opensearch.xml">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"><link rel="stylesheet" href="/assets/css/styles.b45c6643.css">
<script src="/assets/js/runtime~main.363e8e76.js" defer="defer"></script>
<script src="/assets/js/main.df29f4cc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"dark")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Centrifugo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Centrifugo</b></a><a class="navbar__item navbar__link" href="/docs/getting-started/introduction">Getting Started</a><a class="navbar__item navbar__link" href="/docs/server/configuration">Server guide</a><a class="navbar__item navbar__link" href="/docs/transports/overview">Real-time transports / SDK</a><a class="navbar__item navbar__link" href="/docs/pro/overview">Centrifugo PRO ♻️</a><a class="navbar__item navbar__link" href="/docs/faq">FAQ</a><a class="navbar__item navbar__link" href="/docs/tutorial/intro">Grand tutorial</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/centrifugal/centrifugo" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/docs/getting-started/introduction">v6</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/getting-started/introduction">v6</a></li><li><a class="dropdown__link" href="/docs/5/getting-started/introduction">v5</a></li><li><a class="dropdown__link" href="/docs/4/getting-started/introduction">v4</a></li><li><a class="dropdown__link" href="/docs/3/getting-started/introduction">v3</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite" aria-pressed="true"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1"><article class=""><header><h1 class="title_f1Hy">Centrifugo v3 released</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-08-31T00:00:00.000Z">August 31, 2021</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/logo_animated.svg" alt="Centrifugal team"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Centrifugal team</span></div><small class="authorTitle_nd0D" title="Let the Centrifugal force be with you">Let the Centrifugal force be with you</small><div class="authorSocials_rSDt"></div></div></div></div></div></header><div id="__blog-post-container" class="markdown"><p><img decoding="async" loading="lazy" alt="Centrifuge" src="/assets/images/v3_blog-6965125800468f312aeaa9ae4c45aaf4.jpg" width="1594" height="550" class="img_ev3q"></p>
<p>After almost three years of Centrifugo v2 life cycle we are happy to announce the next major release of Centrifugo. During the last several months deep in our Centrifugal laboratory we had been synthesizing an improved version of the server.</p>
<p>New Centrifugo v3 is targeting to improve Centrifugo adoption for basic real-time application cases, improves server performance and extends existing features with new functionality. It comes with unidirectional real-time transports, protocol speedups, super-fast engine implementation based on Tarantool, new documentation site, GRPC proxy, API extensions and PRO version which provides unique possibilities for business adopters.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centrifugo-v2-flashbacks">Centrifugo v2 flashbacks<a href="#centrifugo-v2-flashbacks" class="hash-link" aria-label="Direct link to Centrifugo v2 flashbacks" title="Direct link to Centrifugo v2 flashbacks">​</a></h3>
<p>Centrifugo v2 life cycle has come to an end. Before discussing v3 let&#x27;s look back at what has been done during the last three years.</p>
<p>Centrifugo v2 was a pretty huge refactoring of v1. Since the v2 release, Centrifugo is built on top of  new <a href="https://github.com/centrifugal/centrifuge" target="_blank" rel="noopener noreferrer">Centrifuge library</a> for Go language. Centrifuge library evolved significantly since its initial release and now powers Grafana v8 real-time streaming among other things.</p>
<p>Here is an awesome demo made by my colleague <a href="https://github.com/alexanderzobnin">Alexander Zobnin</a> that demonstrates real-time telemetry of Assetto Corsa sports car streamed in real-time to Grafana dashboard:</p>
<div class="vimeo-full-width"><iframe src="https://player.vimeo.com/video/570333329?title=0&amp;byline=0&amp;portrait=0" frameborder="0" allow="autoplay; fullscreen" allowfullscreen=""></iframe></div>
<p></p>
<p>Centrifugo integrated with Redis Streams, got Redis Cluster support, can now work with Nats server as a PUB/SUB broker. Notable additions of Centrifugo v2 were <a href="/docs/server/server_subs">server-side subscriptions</a> with some interesting features on top – like maintaining a single global connection from one user and automatic personal channel subscription upon user connect.</p>
<p>A very good addition which increased Centrifugo adoption a lot was introduction of <a href="/docs/server/proxy">proxy to backend</a>. This made Centrifugo fit many setups where JWT authentication and existing subscription permission model did not suit well before.</p>
<p>Client ecosystem improved significantly. The fact that client protocol migrated to a strict Protobuf schema allowed to introduce binary protocol format (in addition to JSON) and simplify building client connectors. We now have much better and complete client libraries (compared to v1 situation).</p>
<p>We also have an <a href="https://github.com/centrifugal/helm-charts" target="_blank" rel="noopener noreferrer">official Helm chart</a>, <a href="https://grafana.com/grafana/dashboards/13039" target="_blank" rel="noopener noreferrer">Grafana dashboard</a> for Prometheus datasource, and so on.</p>
<p><img decoding="async" loading="lazy" src="https://grafana.com/api/dashboards/13039/images/8950/image" alt="" class="img_ev3q"></p>
<p>Centrifugo is becoming more noticeable in a wider real-time technology community. For example, it was included in a <a href="https://ably.com/periodic-table-of-realtime" target="_blank" rel="noopener noreferrer">periodic table of real-time</a> created by Ably.com (one of the most powerful real-time messaging cloud services at the moment):</p>
<p><img decoding="async" loading="lazy" src="https://ik.imagekit.io/ably/ghost/prod/2021/08/periodic-table-screenshots-combined-without-banner-no-legend.jpg?tr=w-1520" alt="" class="img_ev3q"></p>
<p>Of course, there are many aspects where Centrifugo can be improved. And v3 addresses some of them. Below we will look at the most notable features and changes of the new major Centrifugo version.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="backwards-compatibility">Backwards compatibility<a href="#backwards-compatibility" class="hash-link" aria-label="Direct link to Backwards compatibility" title="Direct link to Backwards compatibility">​</a></h3>
<p>Let&#x27;s start with the most important thing – backwards compatibility concerns.</p>
<p>In Centrifugo v3 client protocol mostly stayed the same. We expect that most applications will be able to update without any change on a client-side. This was an important concern for v3 given how painful the update cycle can be on mobile devices and lessons learned from v1 to v2 migration. There is one breaking change though which can affect users who use history API manually from a client-side (we provide a temporary workaround to give apps a chance to migrate smoothly).</p>
<p>On a server-side, much more changes happened, especially in the configuration: some options were renamed, some were removed. We provide a <a href="/docs/3/getting-started/migration_v3#v2-to-v3-config-converter">v2 to v3 configuration converter</a> which can help dealing with changes. In most cases, all you should do is adapt Centrifugo configuration to match v3 changes and redeploy Centrifugo using v3 build instead of v2. All features are still there (or a replacement exists, like for <code>channels</code> API).</p>
<p>For more details, refer to the <a href="/docs/3/getting-started/migration_v3">v3 migration guide</a>.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="license-change">License change<a href="#license-change" class="hash-link" aria-label="Direct link to License change" title="Direct link to License change">​</a></h3>
<p>As some of you know we considered changing Centrifugo license to AGPL v3 for a new release. After thinking a lot about this we decided to not step into this area.</p>
<p>But the license has been changed: the license of OSS Centrifugo is now Apache 2.0 instead of MIT. Apache 2.0 is also a permissive OSS license, it&#x27;s just a bit more concrete in some aspects.</p>
<p><img decoding="async" loading="lazy" src="https://user-images.githubusercontent.com/2097922/91162089-8570e100-e6c3-11ea-8c41-cd8fcfe049d0.png" alt="" class="img_ev3q"></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="unidirectional-real-time-transports">Unidirectional real-time transports<a href="#unidirectional-real-time-transports" class="hash-link" aria-label="Direct link to Unidirectional real-time transports" title="Direct link to Unidirectional real-time transports">​</a></h3>
<p>Server-side subscriptions introduced in Centrifugo v2 and recent improvements in the underlying Centrifuge library opened a road for a unidirectional approach.</p>
<p>This means that Centrifugo v3 provides a set of unidirectional real-time transports where messages flow only in one direction – from a server to a client. Why is this change important?</p>
<p>Centrifugo originally concentrated on using bidirectional transports for client-server communication. Like WebSocket and SockJS. Bidirectional transports allow implementing some great protocol features since a client can communicate with a server in various ways after establishing a persistent connection. While this is a great opportunity this also leads to an increased complexity.</p>
<p>Centrifugo users had to use special client connector libraries which abstracted underlying work into a simple public API. But internally connectors do many things: matching requests to responses, handling timeouts, handling an ordering, queuing operations, error handling. So the client connector is a pretty complex piece of software.</p>
<p>But what if a user just needs to receive real-time updates from a stable set of channels known in connection time? Can we simplify everything and avoid using custom software on a client-side?</p>
<p>With unidirectional transports, the answer is yes. Clients can now connect to Centrifugo using a bunch of unidirectional transports. And the greatest thing is that in this case, developers should not depend on Centrifugo client connectors at all – just use native browser APIs or GRPC-generated code. It&#x27;s finally possible to consume events from Centrifugo using CURL (see <a href="/docs/transports/uni_http_stream#connecting-using-curl">an example</a>).</p>
<p>Using unidirectional transports you can still benefit from Centrifugo built-in scalability with various engines, utilize built-in authentication over JWT or the connect proxy feature.</p>
<p>With subscribe server API (see below) it&#x27;s even possible to subscribe unidirectional client to server-side channels dynamically. With refresh server API or the refresh proxy feature it&#x27;s possible to manage a connection expiration.</p>
<p>Centrifugo supports the following unidirectional transports:</p>
<ul>
<li><a href="/docs/transports/uni_sse">EventSource (SSE)</a></li>
<li><a href="/docs/transports/uni_http_stream">HTTP streaming</a></li>
<li><a href="/docs/transports/uni_websocket">Unidirectional WebSocket</a></li>
<li><a href="/docs/transports/uni_grpc">Unidirectional GRPC stream</a></li>
</ul>
<p>We expect that introducing unidirectional transports will significantly increase Centrifugo adoption.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="history-iteration-api">History iteration API<a href="#history-iteration-api" class="hash-link" aria-label="Direct link to History iteration API" title="Direct link to History iteration API">​</a></h3>
<img src="/img/centrifuge.svg" align="right" width="25%">
<p>There was a rather important limitation of Centrifugo history API – it was not very suitable for keeping large streams because a call to a history could only return the entire channel history.</p>
<p>Centrifugo v3 introduces an API to iterate over a stream. It&#x27;s possible to do from the current stream beginning or end, in both directions – forward and backward, with configured limit. Also with certain starting stream position if it&#x27;s known.</p>
<p>This, among other things, can help to implement manual missed message recovery on a client-side to reduce the load on the application backend.</p>
<p>Here is an example program in Go which endlessly iterates over stream both ends (using <a href="https://github.com/centrifugal/gocent" target="_blank" rel="noopener noreferrer">gocent</a> API library), upon reaching the end of stream the iteration goes in reversed direction (not really useful in real world but fun):</p>
<div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Iterate by 10.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">limit </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Paginate in reversed order first, then invert it.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">reverse </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Start with nil StreamPosition, then fill it with value while paginating.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> sp </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">gocent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">StreamPosition</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	historyResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">History</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ctx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        channel</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		gocent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">WithLimit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">limit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		gocent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">WithReverse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">reverse</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        gocent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">WithSince</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sp</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> err </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Fatalf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Error calling history: %v&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> pub </span><span class="token operator" style="color:rgb(137, 221, 255)">:=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">range</span><span class="token plain"> historyResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Publications </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;=&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		sp </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">gocent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">StreamPosition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			Offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> pub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Offset</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">			Epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">  historyResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Epoch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">len</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">historyResult</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">Publications</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> limit </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Got all pubs, invert pagination direction.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		reverse </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain">reverse</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">		log</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">Println</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;end of stream reached, change iteration direction&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">	</span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>This new API does not remove the need in having the main application database – that&#x27;s still mandatory for idiomatic Centrifugo usage.</p></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="redis-streams-by-default">Redis Streams by default<a href="#redis-streams-by-default" class="hash-link" aria-label="Direct link to Redis Streams by default" title="Direct link to Redis Streams by default">​</a></h3>
<p>In Centrifugo v3 Redis engine uses Redis Stream data structure by default for keeping channel history. Before v3 Redis Streams were supported by not enabled by default so almost nobody used them. This change is important in terms of introducing history iteration API described above – since Redis Streams allow doing iteration effectively.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="tarantool-engine">Tarantool engine<a href="#tarantool-engine" class="hash-link" aria-label="Direct link to Tarantool engine" title="Direct link to Tarantool engine">​</a></h3>
<p>As you may know, Centrifugo has several built-in engines that allow scaling Centrifugo nodes (using PUB/SUB) and keep shared history and presence state. Before v3 Centrifugo had in-memory and Redis (or KeyDB) engines available.</p>
<p>Introducing a new engine to Centrifugo is pretty hard since the engine should provide a very robust PUB/SUB performance, fast history and presence operations, possibility to publish a message to PUB/SUB and save to history atomically. It also should allow dealing with ephemeral frequently changing subscriptions. It&#x27;s typical for Centrifugo use case to have millions of users each subscribed to a  unique channel and constantly connecting/disconnecting (thus subscribing/unsubscribing).</p>
<p><img decoding="async" loading="lazy" src="https://www.tadviser.ru/images/thumb/1/1a/Tarantool_%D0%A1%D0%A3%D0%91%D0%94_logo_2020.png/840px-Tarantool_%D0%A1%D0%A3%D0%91%D0%94_logo_2020.png" alt="" class="img_ev3q"></p>
<p>In v3 we added <strong>experimental</strong> support for the <a href="https://www.tarantool.io/en/" target="_blank" rel="noopener noreferrer">Tarantool</a> engine. It fits nicely all the requirements above and provides a huge performance speedup for history and presence operations compared to Redis. According to our benchmarks, the speedup can be up to 4-10x depending on operation. The PUB/SUB performance of Tarantool is comparable with Redis (10-20% worse according to our internal benchmarks to be exact, but that&#x27;s pretty much the same).</p>
<p>For example, let&#x27;s look at Centrifugo benchmark where we recover zero messages (i.e. emulate a situations when many connections disconnected for a very short time interval due to load balancer reload).</p>
<p>For Redis engine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">Redis engine, single Redis instance</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkRedisRecover       26883 ns/op	    1204 B/op	   28 allocs/op</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Compare it with the same operation measured with Tarantool engine:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">Tarantool engine, single Tarantool instance</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkTarantoolRecover    6292 ns/op	     563 B/op	   10 allocs/op</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Tarantool can provide new storage properties (like synchronous replication), new adoption. We are pretty excited about adding it as an option.</p>
<p>The reason why Tarantool support is experimental is because Tarantool integration involves one more moving piece – the <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">Centrifuge Lua module</a> which should be run by a Tarantool server.</p>
<p>This increases deployment complexity and given the fact that many users have their own best practices in Tarantool deployment we are still evaluating a sufficient way to distribute Lua part. For now, we are targeting standalone (see examples in <a href="https://github.com/centrifugal/tarantool-centrifuge" target="_blank" rel="noopener noreferrer">centrifugal/tarantool-centrifuge</a>) and Cartridge Tarantool setups (with <a href="https://github.com/centrifugal/rotor" target="_blank" rel="noopener noreferrer">centrifugal/rotor</a>).</p>
<p>Refer to the <a href="/docs/server/engines#tarantool-engine">Tarantool Engine documentation</a> for more details.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="grpc-proxy">GRPC proxy<a href="#grpc-proxy" class="hash-link" aria-label="Direct link to GRPC proxy" title="Direct link to GRPC proxy">​</a></h3>
<p>Centrifugo can now transform events received over persistent connections from users into GRPC calls to the application backend (in addition to the HTTP proxy available in v2).</p>
<p>GRPC support should make Centrifugo ready for today&#x27;s microservice architecture where GRPC is a huge player for inter-service communication.</p>
<p>So we mostly just provide more choices for Centrifugo users here. GRPC has some good advantages – for example an application backend RPC layer which is responsible for communication with Centrifugo can now be generated from Protobuf definitions for all popular programming languages.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="server-api-improvements">Server API improvements<a href="#server-api-improvements" class="hash-link" aria-label="Direct link to Server API improvements" title="Direct link to Server API improvements">​</a></h3>
<img src="/img/test-tube.svg" align="right" width="25%">
<p>Centrifugo v3 has some valuable server API improvements.</p>
<p>The new <code>subscribe</code> API method allows subscribing connection to a channel at any point in time. This works by utilizing server-side subscriptions. So it&#x27;s not only possible to subscribe connection to a list of server-side channels during the connection establishment phase – but also later during the connection lifetime. This may be very useful for the unidirectional approach - by emulating client-side subscribe call over request to application backend which in turn calls subscribe Centrifugo server API.</p>
<p>Publish API now returns the current top stream position (offset and epoch) for channels with history enabled.</p>
<p>Server history API inherited iteration possibilities described above.</p>
<p>Channels command now returns a number of clients in a channel, also supports channel filtering by a pattern. Since we changed how channels call implemented internally there is no limitation anymore to call it when using Redis cluster.</p>
<p>Admin web UI has been updated too to support new API methods, so you can play with new API from its <code>actions</code> tab.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="better-clustering">Better clustering<a href="#better-clustering" class="hash-link" aria-label="Direct link to Better clustering" title="Direct link to Better clustering">​</a></h3>
<p>Centrifugo behaves a bit better in cluster mode: as soon as a node leaves a cluster gracefully (upon graceful termination) it sends a shutdown signal to the control channel thus giving other nodes a chance to immediately delete that node from the local registry.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="client-improvements">Client improvements<a href="#client-improvements" class="hash-link" aria-label="Direct link to Client improvements" title="Direct link to Client improvements">​</a></h3>
<p>While preparing the v3 release we improved client connectors too. All existing client connectors now actualized to the latest protocol, support server-side subscriptions, history API.</p>
<p>One important detail is that it&#x27;s not required to set <code>?format=protobuf</code> URL param now when connecting to Centrifugo from mobile devices - this is now managed internally by using the WebSocket subprotocol mechanism (requires using the latest client connector version and Centrifugo v3).</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="new-documentation-site">New documentation site<a href="#new-documentation-site" class="hash-link" aria-label="Direct link to New documentation site" title="Direct link to New documentation site">​</a></h3>
<p>You are reading this post on a new project site. It&#x27;s built with amazing <a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer">Docusaurus</a>.</p>
<p>A lot of documents were actualized, extended, and rewritten. We also now have new chapters like:</p>
<ul>
<li><a href="/docs/getting-started/highlights">Main highlights</a></li>
<li><a href="/docs/getting-started/design">Design overview</a></li>
<li><a href="/docs/server/history_and_recovery">History and recovery</a></li>
<li><a href="/docs/server/codes">Error and disconnect codes</a>.</li>
</ul>
<p>Server API and proxy documentation have been improved significantly.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="performance-improvements">Performance improvements<a href="#performance-improvements" class="hash-link" aria-label="Direct link to Performance improvements" title="Direct link to Performance improvements">​</a></h3>
<img src="/img/stopwatch.svg" align="right" width="25%">
<p>Centrifugo v3 has some notable performance improvements.</p>
<p>JSON client protocol now utilizes a couple of libraries (<code>easyjson</code> for encoding and <code>segmentio/encoding</code> for unmarshaling). Actually we use a slightly customized version of <code>easyjson</code> library to achieve even faster performance than it provides out-of-the-box. Changes allowed to speed up JSON encoding and decoding up to 4-5x for small messages. For large payloads speed up can be even more noticeable – we observed up to 30x performance boost when serializing 5kb messages.</p>
<p>For example, let&#x27;s look at a JSON serialization benchmark result for 256 byte payload. Here is what we had before:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">Centrifugo v2 JSON encoding/decoding</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkMarshal-12              	 5883 ns/op	    1121 B/op	    6 allocs/op</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkMarshalParallel-12      	 1009 ns/op	    1121 B/op	    6 allocs/op</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkUnmarshal-12            	 1717 ns/op	    1328 B/op	   16 allocs/op</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkUnmarshalParallel-12    	492.2 ns/op	    1328 B/op	   16 allocs/op</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>And what we have now with mentioned JSON optimizations:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_Ktv7">Centrifugo v3 JSON encoding/decoding</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cpu: Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkMarshal-12              	 461.3 ns/op	 928 B/op	    3 allocs/op</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkMarshalParallel-12      	 250.6 ns/op	 928 B/op	    3 allocs/op</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkUnmarshal-12            	 476.5 ns/op	 136 B/op	    3 allocs/op</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BenchmarkUnmarshalParallel-12    	 107.2 ns/op	 136 B/op	    3 allocs/op</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Centrifugo Protobuf protocol is still faster than JSON for encoding/decoding on a server-side.</p></div></div>
<p>Of course, JSON encoding is only one part of Centrifugo – so you should not expect overall 4x performance improvement. But loaded setups should notice the difference and this should also be a good thing for reducing garbage collection pauses.</p>
<p>Centrifugo inherited a couple of other improvements from the Centrifuge library.</p>
<p>In-memory connection hub is now sharded – this should reduce lock contention between operations in different channels. In <a href="https://github.com/centrifugal/centrifuge/pull/184" target="_blank" rel="noopener noreferrer">our artificial benchmarks</a> we noticed a 3x better hub throughput, but in reality the benefit is heavily depends on the usage pattern.</p>
<p>Centrifugo now allocates less during message broadcasting to a large number of subscribers.</p>
<p>Also, an upgrade to Go 1.17 for builds results in ~5% performance boost overall, thanks to a new way of passing function arguments and results using registers instead of the stack introduced in Go 1.17.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="centrifugo-pro">Centrifugo PRO<a href="#centrifugo-pro" class="hash-link" aria-label="Direct link to Centrifugo PRO" title="Direct link to Centrifugo PRO">​</a></h3>
<p>The final notable thing is an introduction of Centrifugo PRO. This is an extended version of Centrifugo built on top of the OSS version. It provides some unique features targeting business adopters.</p>
<p>Those who followed Centrifugo for a long time know that there were some attempts to make project development sustainable. Buy me a coffee and Opencollective approaches were not successful, during a year we got ~300$ of total contributions. While we appreciate these contributions a lot - this does not fairly justify a time spent on Centrifugo maintenance these days and does not allow bringing it to the next level. So here is an another attempt to monetize Centrifugo.</p>
<p>Centrifugo PRO details and features described <a href="/docs/pro/overview">here in docs</a>. Let&#x27;s see how it goes. We believe that a set of additional functionality can provide great advantages for both small and large-scale Centrifugo setups. PRO features can give useful insights on a system, protect from client API misusing, reduce server resource usage, and more.</p>
<p>PRO version will be released soon after Centrifugo v3 OSS.</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h3>
<p>There are some other changes introduced in v3 but not mentioned here. The full list can be found in the release notes and the migration guide.</p>
<p>Hope we stepped into an exciting time of the v3 life cycle and many improvements will follow. Join our communities in Telegram and Discord if you have questions or want to follow Centrifugo development:</p>
<p><a href="https://t.me/joinchat/ABFVWBE0AhkyyhREoaboXQ" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://img.shields.io/badge/Telegram-Group-orange?style=flat&amp;logo=telegram" alt="Join the chat at https://t.me/joinchat/ABFVWBE0AhkyyhREoaboXQ" class="img_ev3q"></a>  <a href="https://discord.gg/tYgADKx" target="_blank" rel="noopener noreferrer"><img decoding="async" loading="lazy" src="https://img.shields.io/discord/719186998686122046?style=flat&amp;label=Discord&amp;logo=discord" alt="Join the chat at https://discord.gg/tYgADKx" class="img_ev3q"></a></p>
<p>Enjoy Centrifugo v3, and let the Centrifugal force be with you.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Special thanks</div><div class="admonitionContent_BuS1"><p>Special thanks to <a href="https://github.com/silischev" target="_blank" rel="noopener noreferrer">Anton Silischev</a> for the help with v3 tests, examples and CI. To <a href="https://github.com/leeoniya" target="_blank" rel="noopener noreferrer">Leon Sorokin</a> for the spinning CSS Centrifugo logo. To <a href="https://github.com/filonenko-mikhail" target="_blank" rel="noopener noreferrer">Michael Filonenko</a> for the help with Tarantool. To <a href="https://github.com/mogol" target="_blank" rel="noopener noreferrer">German Saprykin</a> for Dart magic.</p><p>Thanks to the community members who tested out Centrifugo v3 beta, found bugs and sent improvements.</p><div>Icons used here made by <a href="https://www.flaticon.com/authors/wanicon" title="wanicon">wanicon</a> from <a href="https://www.flaticon.com/" title="Flaticon"><a href="http://www.flaticon.com" target="_blank" rel="noopener noreferrer">www.flaticon.com</a></a></div></div></div></div><footer class="docusaurus-mt-lg"><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/centrifugo">centrifugo</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/release">release</a></li></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class="col"><a href="https://github.com/centrifugal/centrifugal.dev/edit/main/blog/2021-08-31-hello-centrifugo-v3.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2021/10/18/integrating-with-nodejs"><div class="pagination-nav__sublabel">Newer post</div><div class="pagination-nav__label">Centrifugo integration with NodeJS tutorial</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2021/01/15/centrifuge-intro"><div class="pagination-nav__sublabel">Older post</div><div class="pagination-nav__label">Centrifuge – real-time messaging with Go</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#centrifugo-v2-flashbacks" class="table-of-contents__link toc-highlight">Centrifugo v2 flashbacks</a></li><li><a href="#backwards-compatibility" class="table-of-contents__link toc-highlight">Backwards compatibility</a></li><li><a href="#license-change" class="table-of-contents__link toc-highlight">License change</a></li><li><a href="#unidirectional-real-time-transports" class="table-of-contents__link toc-highlight">Unidirectional real-time transports</a></li><li><a href="#history-iteration-api" class="table-of-contents__link toc-highlight">History iteration API</a></li><li><a href="#redis-streams-by-default" class="table-of-contents__link toc-highlight">Redis Streams by default</a></li><li><a href="#tarantool-engine" class="table-of-contents__link toc-highlight">Tarantool engine</a></li><li><a href="#grpc-proxy" class="table-of-contents__link toc-highlight">GRPC proxy</a></li><li><a href="#server-api-improvements" class="table-of-contents__link toc-highlight">Server API improvements</a></li><li><a href="#better-clustering" class="table-of-contents__link toc-highlight">Better clustering</a></li><li><a href="#client-improvements" class="table-of-contents__link toc-highlight">Client improvements</a></li><li><a href="#new-documentation-site" class="table-of-contents__link toc-highlight">New documentation site</a></li><li><a href="#performance-improvements" class="table-of-contents__link toc-highlight">Performance improvements</a></li><li><a href="#centrifugo-pro" class="table-of-contents__link toc-highlight">Centrifugo PRO</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Contact us</div><ul class="footer__items clean-list"><li class="footer__item"><a href="mailto:hello@centrifugal.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Send e-mail</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://t.me/joinchat/U57MI8Lam9mhpuhd" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discord.gg/tYgADKx" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/centrifugalabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/attributions">Attributions</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Centrifugal Labs LTD</div></div></div></footer></div>
</body>
</html>